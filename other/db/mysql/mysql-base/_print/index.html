<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=/other/db/mysql/mysql-base/><link rel=alternate type=application/rss+xml href=/other/db/mysql/mysql-base/index.xml><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Mysql基础知识 | 蚂蚁背大象</title><meta property="og:title" content="Mysql基础知识"><meta property="og:description" content="蚂蚁背大象博客"><meta property="og:type" content="website"><meta property="og:url" content="/other/db/mysql/mysql-base/"><meta property="og:site_name" content="蚂蚁背大象"><meta itemprop=name content="Mysql基础知识"><meta itemprop=description content="蚂蚁背大象博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mysql基础知识"><meta name=twitter:description content="蚂蚁背大象博客"><link rel=preload href=/scss/main.min.e09cb23c7dff3bf1285aa0294bcdc4ac8194fb3425a99c621e31e7b871315685.css as=style><link href=/scss/main.min.e09cb23c7dff3bf1285aa0294bcdc4ac8194fb3425a99c621e31e7b871315685.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">蚂蚁背大象</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>Home</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Java</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/spring/><span>Spring</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/middlewares/><span>Middleware</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/other/><span class=active>Others</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/other/db/mysql/mysql-base/>Return to the regular view of this page</a>.</p></div><h1 class=title>Mysql基础知识</h1><ul><li>1: <a href=#pg-e0e58cd7fe078fdb821378315a1476c5>mysql索引1-索引如何组织数据</a></li><li>2: <a href=#pg-98acea010485c71694a9e83d4912ee6a>mysql索引2-索引分类</a></li><li>3: <a href=#pg-b02679d8b8f3028059cd65c9826ccf54>mysql索引3-索引匹配和SQL优化</a></li><li>4: <a href=#pg-53a5a5c185e31e14ab9d9ad9d4075318>MySQL几种索引的区别</a></li><li>5: <a href=#pg-5a47e7eaf772733bc8247b0243ce3c2c>行溢出</a></li><li>6: <a href=#pg-7ed18dddab526c61f5d89c53439c832c>存储引擎</a></li><li>7: <a href=#pg-b2fc20b51acddf5ec8ad59e51421b5c9>MySQL的优化</a></li><li>8: <a href=#pg-660f64ff0579f3e10fffc1e77700b899>MySQL主从复制原理</a></li></ul><div class=content><p>文章中用到的数据都是MySQL官网提供的。具体地址为：https://dev.mysql.com/doc/index-other.html</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e0e58cd7fe078fdb821378315a1476c5>1 - mysql索引1-索引如何组织数据</h1><h3 id=1-mysql索引分类>1. mysql索引分类</h3><p>mysql索引主要分为两类：</p><ul><li><p>主键索引</p><p>每一张表的主键就是一个索引。mysql中组织数据也是通过该字段。在没有手动指定主键的情况下，mysql会自动生成一列 <em><strong>row_id</strong></em> 来作为主键。</p></li><li><p>辅助索引</p><p>常用的唯一索引，组合索引，普通的索引都是辅助索引。</p></li></ul><blockquote><p>主键索引和唯一索引的区别：</p><ul><li>唯一索引可以为空值，主键索引不能</li><li>mysql一张表只能有一个主键索引，而可以拥有多个唯一索引</li><li>主键索引一定是一个唯一索引，而唯一索引不一定是主键索引</li></ul></blockquote><h3 id=2-主键索引的组织数据方式>2. 主键索引的组织数据方式</h3><p>mysql的数据逻辑组织方式如下图：</p><p><img src="https://github.com/mxsm/picture/blob/main/mysql/innodbtablestruct.png?raw=true" alt=组成图示></p><p>下面看下主键组织数据的情况，也就是主键索引：</p><p><img src="https://github.com/mxsm/picture/blob/main/mysql/mysql%E4%B8%BB%E9%94%AE%E7%BB%84%E7%BB%87%E6%95%B0%E6%8D%AE.png?raw=true" alt></p><p>B+数组织的是mysql中的页数据。在B+树中的非叶子节点，存储的是主键和页号的指针。对于叶子节点存入的row数据。</p><blockquote><p>在B+tree上有两头指针，一个指向根节点，另个知晓关键字的最小的叶子节点，而且所有的叶子及诶单之间是一种链式环结构。因此B+tree可以做两种查找运算:</p><ul><li>对主键范围查找和分页查找</li><li>根节点开始的随机查找</li></ul></blockquote><p>这里通过会有一个计算层数能够存储的数据估算，例如：主键为int（4byte）,页号指针6byte那么对于非叶子节点能够存储的数据量为，16K / (4+6) 能够存储1600条索引数据那么对于上面来说Degree=3的B+tree。假设一条记录的所占的空间为1K那么mysql一页数据可以存储16条数据。公式如下：</p><p>1600 X 1600 X 16 = 40960000 。</p><blockquote><p>InnoDB是通过B+tree结构对主键创建索引，然后叶子节点存储记录。如果没有主键，那么会选择唯一建。如果没有唯一健就会生成一个六个字节的row_id来作为主键。</p></blockquote><h3 id=3-辅助索引组织数据的方式>3. 辅助索引组织数据的方式</h3><p>数据的组织方式如下图：</p><p><img src="https://github.com/mxsm/picture/blob/main/mysql/mysql%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E7%BB%84%E7%BB%87%E6%95%B0%E6%8D%AE%E6%96%B9%E5%BC%8F.png?raw=true" alt></p><p>辅助索引非叶子节点的数据为：辅助索引值+页号的指针数据，叶子节点为辅助索引的数据和主键的索引。</p><h3 id=4-总结>4. 总结</h3><ul><li>主键索引叶子节点跟的是数据，而负责索引叶子节点跟的主键。</li><li>如果查询包含所有的辅助索引并且能够符合索引的匹配原则，那么这种情况下就不需要进行回表查询数据，这也叫覆盖索引</li></ul><blockquote><p>我是蚂蚁背大象，文章对你有帮助点赞关注我，文章有不正确的地方请您斧正留言评论~谢谢！</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-98acea010485c71694a9e83d4912ee6a>2 - mysql索引2-索引分类</h1><blockquote><p>mysql 版本为8.0版本</p></blockquote><p>[TOC]</p><p>在mysql的使用中，索引是一个少不了的话题，经常会听到很多关于索引的名称。比如全文索引，唯一索引等等。五花八门，下面我们就来对这些索引进行一一的说明。图如下：</p><p><img src="https://github.com/mxsm/picture/blob/main/mysql/mysql%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB.png?raw=true" alt></p><p>创建索引的语法(<a href=https://dev.mysql.com/doc/refman/8.0/en/create-index.html>来源mysql官网</a>):</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>UNIQUE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FULLTEXT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SPATIAL</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>index_name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>index_type</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tbl_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key_part</span><span style=color:#000;font-weight:700>,...)</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>index_option</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>algorithm_option</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>lock_option</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>key_part</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>{</span><span style=color:#000>col_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[(</span><span style=color:#204a87;font-weight:700>length</span><span style=color:#000;font-weight:700>)]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>expr</span><span style=color:#000;font-weight:700>)</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>ASC</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DESC</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>index_option</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>KEY_BLOCK_SIZE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>index_type</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>WITH</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PARSER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>parser_name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>COMMENT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;string&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>{</span><span style=color:#000>VISIBLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>INVISIBLE</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ENGINE_ATTRIBUTE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;string&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SECONDARY_ENGINE_ATTRIBUTE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;string&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>index_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>{</span><span style=color:#000>BTREE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HASH</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>algorithm_option</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>ALGORITHM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>{</span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>INPLACE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>COPY</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>lock_option</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>LOCK</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>{</span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NONE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SHARED</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>EXCLUSIVE</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><blockquote><p>Note: create index 不能创建主键</p></blockquote><h3 id=1-主键索引>1. 主键索引</h3><p>mysql中Innodb存储引擎来说，一张表只能有一个主键索引。</p><blockquote><p>rowId MySQL的InnoDB引擎默认采用索引组织表</p></blockquote><h3 id=2-辅助索引>2. 辅助索引</h3><p>什么叫辅助索引？主键意外的索引就叫辅助索引。这里包含了我们平时说的唯一索引，组合索引，普通索引。</p><p><img src="https://github.com/mxsm/picture/blob/main/mysql/mysql%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB1.png?raw=true" alt></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>--创建普通索引使用的是B+tree
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>UNIQUE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>--创建唯一索引
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FULLTEXT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>--创建全文索引
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SPATIAL</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>--创建空间索引
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>world</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>.</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>city</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ADD</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FULLTEXT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>CountryCode</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>CountryCode</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>--创建索引
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>--删除索引
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>索引名称</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>表名</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>ALTER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>表名</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DROP</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>索引名称</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=21-普通索引>2.1 普通索引</h4><p>普通索引就是平时常见创建的索引。可以针对一个列或者多个列进行创建索引。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#a40000>对单个字段建立索引</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span><span style=color:#000>age</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#a40000>对多个字段建立索引</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h4 id=22-唯一索引>2.2 唯一索引</h4><p>它与前面的"普通索引"类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>UNIQUE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>--</span><span style=color:#a40000>创建唯一索引</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>drop</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>index</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>-- 删除索引
</span></code></pre></div><h4 id=23-全文索引>2.3 全文索引</h4><p>全文检索技术是智能信息管理的关键技术之一，其主要目的就是实现对大容量的非结构化数据的快速查找。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FULLTEXT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>--创建全文索引
</span></code></pre></div><h4 id=24-空间索引>2.4 空间索引</h4><p>InnoDB支持空间索引，通过R树来实现，使得空间搜索变得高效</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>SPATIAL</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INDEX</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>part_of_name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>customer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>--</span><span style=color:#a40000>创建空间索引</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h3 id=3-聚族索引和非聚族索引>3. 聚族索引和非聚族索引</h3><p>聚族索引和非聚族索引说的是对数据的组织方式。</p><ul><li>聚族索引：叶子节点存放的是记录的数据</li><li>非聚族索引：叶子节点存放的是主键的数据</li></ul><h3 id=4-覆盖索引>4. 覆盖索引</h3><p>覆盖索引（covering index）指一个查询语句的执行只用从索引中就能够取得，不必从数据表中读取。也可以称之为实现了索引覆盖。如果索引包含所有满足查询需要的数据的索引成为覆盖索引(Covering Index)，也就是平时所说的不需要回表操作。</p><blockquote><p>是否需要回表来判断是否为覆盖索引。</p><p>使用explain，可以通过输出的extra列来判断，对于一个索引覆盖查询，显示为<strong>using index</strong>,MySQL查询优化器在执行查询前会决定是否有索引覆盖查询</p></blockquote><h3 id=5-组合索引>5. 组合索引</h3><p>所谓的组合索引其实是对索引的列的多少来进行分类的。例如一行的话就是我们经常用到的索引方式。 对于大于1列的索引我们叫做组合索引。</p><h4 id=51-什么时候创建组合索引>5.1 什么时候创建组合索引</h4><p>当我们的where查询存在多个条件查询的时候，我们需要对查询的列创建组合索引</p><h4 id=52-组合索引相比每个字段索引的好处>5.2 组合索引相比每个字段索引的好处</h4><ul><li><p><strong>减少开销</strong></p><p>比如对col1、col2、col3创建组合索引，相当于创建了（col1）、（col1，col2）、（col1，col2，col3）3个索引。</p></li><li><p><strong>覆盖索引</strong></p><p>通过组合索引直接查出来。假如查询SELECT col1, col2, col3 FROM 表名，由于查询的字段存在索引页中，那么可以从索引中直接获取，而不需要回表查询。</p></li><li><p><strong>效率高</strong></p><p><em><code>对col1、col2、col3三列分别创建索引，MySQL只会选择辨识度高的一列作为索引</code></em> 。假设有100w的数据，一个索引筛选出10%的数据，那么可以筛选出10w的数据；对于组合索引而言，可以筛选出100w*10%*10%*10%=1000条数据</p></li></ul><h4 id=53-对于查询及存在组合索引有存在单一索引数据库如何处理>5.3 对于查询及存在组合索引有存在单一索引数据库如何处理？</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>Student</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classname</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classNumber</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NULL</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>PRIMARY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>test_index</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>,</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classname</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>,</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classNumber</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>name_index</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classname_index</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classname</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>KEY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classNumber</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>classNumber</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USING</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BTREE</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ENGINE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>InnoDB</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DEFAULT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CHARSET</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>utf8mb4</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p>表中的数据：</p><p><img src="https://github.com/mxsm/document/blob/master/image/database/indexTest.png?raw=true" alt=数据></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/select1.png?raw=true" alt=情况1></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/selection2.png?raw=true" alt=情况2></p><p>从上图可以看出：<strong>最左匹配原则和字段的在前和在后面没有关系</strong></p><hr><p><img src="https://github.com/mxsm/document/blob/master/image/database/selection3.png?raw=true" alt=情况2></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/selection4.png?raw=true" alt=情况2></p><p>从上图可以看出：<strong>在一个字段如果符合最左匹配原则就优先使用最左匹配原则。</strong></p><p><strong>假设我们创建（col1，col2，col3）这样的一个组合索引，那么相当于对col1列进行排序，也就是我们创建组合索引，以最左边的为准，只要查询条件中带有最左边的列，那么查询就会使用到索引，和字段在where后面的位置无关。</strong></p><p>参考文档：</p><ul><li><a href=https://www.jianshu.com/p/77eaad62f974>https://www.jianshu.com/p/77eaad62f974</a></li><li><a href=https://www.cnblogs.com/chenpingzhao/p/4776981.html>https://www.cnblogs.com/chenpingzhao/p/4776981.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b02679d8b8f3028059cd65c9826ccf54>3 - mysql索引3-索引匹配和SQL优化</h1><p>「这是我参与2022首次更文挑战的第28天，活动详情查看：<a href=https://juejin.cn/post/7052884569032392740>2022首次更文挑战</a>」</p><ul><li><a href=#1-%E7%B4%A2%E5%BC%95%E5%8C%B9%E9%85%8D>1. 索引匹配</a><ul><li><a href=#11-%E5%85%A8%E5%80%BC%E5%8C%B9%E9%85%8D>1.1 全值匹配</a></li><li><a href=#12-%E5%8C%B9%E9%85%8D%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80>1.2 匹配最左前缀</a></li><li><a href=#13-%E5%8C%B9%E9%85%8D%E5%88%97%E5%89%8D%E7%BC%80>1.3 匹配列前缀</a></li><li><a href=#14-%E5%8C%B9%E9%85%8D%E8%8C%83%E5%9B%B4%E5%80%BC>1.4 匹配范围值</a></li><li><a href=#15-%E7%B2%BE%E7%A1%AE%E5%8C%B9%E9%85%8D%E6%9F%90%E4%B8%80%E5%88%97%E5%B9%B6%E4%B8%94%E8%8C%83%E5%9B%B4%E5%8C%B9%E9%85%8D%E5%8F%A6%E4%B8%80%E5%88%97>1.5 精确匹配某一列并且范围匹配另一列</a></li><li><a href=#16-%E5%8F%AA%E8%AE%BF%E9%97%AE%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95>1.6 只访问索引的查询(覆盖索引)</a></li></ul></li><li><a href=#2-sql%E4%BC%98%E5%8C%96>2. SQL优化</a></li></ul><p>通过前面对索引类型，以及索引对数据的组织方式等了解，本章节来说说索引的匹配和SQL的优化(索引方面的)。</p><blockquote><p>下面用到的例子的数据库来自mysql官网的例子下载地址:<a href=https://dev.mysql.com/doc/index-other.html>官网的数据库</a></p></blockquote><h3 id=1-索引匹配>1. 索引匹配</h3><p><img src=C:%5CUsers%5Cmxsm%5CDocuments%5C%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8C%B9%E9%85%8D%E6%96%B9%E5%BC%8F.png alt></p><p>索引匹配这里大致分为了以上六种。下面通过例子一一来讲解。</p><p>city表中 Name和CountryCode组成组合索引。</p><h4 id=11-全值匹配>1.1 全值匹配</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>Name</span><span style=color:#ce5c00;font-weight:700>`=</span><span style=color:#4e9a06>&#39;Kabul&#39;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>AND</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CountryCode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;AFG&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><img src=C:%5CUsers%5Cmxsm%5CDesktop%5Cpic%5C%E5%85%A8%E5%80%BC%E5%8C%B9%E9%85%8D.png alt></p><h4 id=12-匹配最左前缀>1.2 匹配最左前缀</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>Name</span><span style=color:#ce5c00;font-weight:700>`=</span><span style=color:#4e9a06>&#39;Kabul&#39;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>AND</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>District</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Kabol&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>CountryCode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;AFG&#39;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>AND</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>District</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Kabol&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><img src=C:%5CUsers%5Cmxsm%5CDesktop%5Cpic%5C%E5%8C%B9%E9%85%8D%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80.png alt></p><h4 id=13-匹配列前缀>1.3 匹配列前缀</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>District</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>like</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Ov%&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>District</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>like</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;%Ov%&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><img src=C:%5CUsers%5Cmxsm%5CDesktop%5Cpic%5C%E5%8C%B9%E9%85%8D%E5%88%97%E5%89%8D%E7%BC%80.png alt></p><h4 id=14-匹配范围值>1.4 匹配范围值</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Population</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Population</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>201843</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><img src=C:%5CUsers%5Cmxsm%5CDesktop%5Cpic%5C%E8%8C%83%E5%9B%B4%E5%8C%B9%E9%85%8D.png alt></p><h4 id=15-精确匹配某一列并且范围匹配另一列>1.5 精确匹配某一列并且范围匹配另一列</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Breda&#39;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>and</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CountryCode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;NLD&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><img src=C:%5CUsers%5Cmxsm%5CDesktop%5Cpic%5C%E7%B2%BE%E7%A1%AE%E5%8C%B9%E9%85%8D%E6%9F%90%E4%B8%80%E5%88%97%E5%B9%B6%E4%B8%94%E8%8C%83%E5%9B%B4%E5%8C%B9%E9%85%8D%E5%8F%A6%E4%B8%80%E5%88%97.png alt></p><h4 id=16-只访问索引的查询覆盖索引>1.6 只访问索引的查询(覆盖索引)</h4><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>CountryCode</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>District</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>Population</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;Breda&#39;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>and</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CountryCode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;NLD&#39;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p><img src=C:%5CUsers%5Cmxsm%5CDesktop%5Cpic%5C%E5%8F%AA%E8%AE%BF%E9%97%AE%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9F%A5%E8%AF%A2-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95.png alt></p><h3 id=2-sql优化>2. SQL优化</h3><p>sql优化意义是获取相同的数据能够用最小的时间。SQL的优化有很多方面，例如提高硬件的处理能力。在同一个SQL下硬件处理能力越强的你们SQL也就越快。比如网络的延迟等等。我们这边的SQL主要考虑的是通过优化SQL本身和建立适当的索引来降低查询所需要的时间。</p><ul><li><p>对字段建立适当的索引</p><p>这里说的是建立适当的索引。不是索引越多越好。根据实际情况建立适当的索引。在建立索引的过程中也会有技巧。</p></li><li><p>建表的字段</p><p>一般对于建表的字段来说，根据业务需求建立对应的字段大小。等等</p></li><li><p>SQL本身的优化</p><p>何为SQL本身的优化，例如业务需要表A中的a、b 、c三个字段。在查询的就应该根据条件返回这三个字段。而不是返回全部的字段。这样全部返回增加网络的负担。同样也增加了数据库的负担。 很可能导致一些索引使用不了。</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-53a5a5c185e31e14ab9d9ad9d4075318>4 - MySQL几种索引的区别</h1><h3 id=主键和唯一索引的区别>主键和唯一索引的区别</h3><ul><li>主键是一种约束，唯一索引是一种索引。</li><li>主键创建后一定包含一个唯一索引，唯一索引并不一定就是主键</li><li>主键不能为空，唯一索引可以为空</li><li>主键可以被其他表引用为外键，而唯一索引不能</li><li>一张表只能创建一个主键，但是可以创建多个唯一索引</li></ul><p><strong>总结一下就是：主键包含唯一索引的功能，但是还有部分增强</strong></p><h4 id=聚集索引和非聚集索引的区别>聚集索引和非聚集索引的区别</h4><ul><li><p><strong>聚集索引</strong></p><pre><code>数据行的物理顺序与列值（一般是主键的那一列）的逻辑顺序相同，一个表中只能拥有一个聚集索引
</code></pre></li><li><p><strong>非聚集索引</strong></p><pre><code>该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同，一个表中可以拥有多个非聚集索引
</code></pre></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5a47e7eaf772733bc8247b0243ce3c2c>5 - 行溢出</h1><h3 id=行溢出参考>行溢出参考</h3><p><a href=https://keithlan.github.io/2016/04/07/idb_biger/>行溢出参考</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ed18dddab526c61f5d89c53439c832c>6 - 存储引擎</h1><h3 id=1-myisam存储引擎>1. MyISAM存储引擎</h3><ul><li><strong>特点：</strong><ul><li><strong>不支持行锁(MyISAM只有表锁)</strong>，读取时对需要读到的所有表加锁，写入时则对表加排他锁.</li><li><strong>不支持事务</strong></li><li><strong>不支持外键</strong></li><li><strong>不支持崩溃后的安全恢复</strong></li><li>在表有读取查询的同时，支持往表中插入新纪录</li><li>支持BLOB和TEXT的前500个字符索引，<strong>支持全文索引</strong></li><li><strong>支持延迟更新索引</strong></li><li>对于不会进行修改的表，支持 <strong>压缩表</strong> ，极大地减少了磁盘空间的占用</li></ul></li><li><strong>存储格式</strong><ul><li><strong><code>.frm</code></strong> 文件存储表定义</li><li><strong><code>.MYD</code></strong> 文件存储数据文件</li><li><strong><code>.MYI</code></strong> 文件存储索引文件</li></ul></li></ul><p><strong>行锁表锁</strong></p><pre><code>Mysql的行锁和表锁（ 锁是计算机协调多个进程或纯线程并发访问某一资源的机制）
表级锁： 每次操作锁住整张表。开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低；
行级锁： 每次操作锁住一行数据。开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高；
</code></pre><ul><li><p><strong>索引的实现：</strong></p><p><strong>MyISAM 索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。</strong></p><ul><li><p><strong>主键索引的实现</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/myisamprimarykeyimplments.png?raw=true" alt=图解></p></li><li><p><strong>辅助索引：</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/myisamsecondarykeyimplments.png?raw=true" alt=图片></p></li></ul></li></ul><p>在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别。只是主索引要求key是唯一的，而辅助索引的key可以重复。<strong>data域保存数据记录的地址，因为数据文件和索引文件是分开的。</strong></p><p><strong>MyISAM</strong> 中索引检索的算法为首先按照 <strong>B+Tree</strong> 搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。</p><p>MyISAM的索引方式也叫做“<strong>非聚集</strong>”的，之所以这么称呼是为了与InnoDB的聚集索引区分。</p><h4 id=知识点补充>知识点补充</h4><pre><code>什么叫非聚集索引？
非聚集索引索引项顺序存储，但索引项对应的内容却是随机存储的；
什么是聚集索引？
聚集索引表记录的排列顺序与索引的排列顺序一致
</code></pre><h3 id=2-innodb>2. InnoDB</h3><ul><li><p><strong>特点：</strong></p><ul><li><strong>支持行锁</strong>，采用MVCC来支持高并发，有可能死锁。</li><li>支持事务</li><li>支持外键</li><li><strong>支持崩溃后的安全恢复</strong></li><li><strong>不支持全文索引</strong></li></ul></li><li><p><strong>索引的实现</strong></p><p><strong><code>InnoDB</code></strong> 和 <strong><code>MyISAM</code></strong> 一样索引都是用的 <strong><code>B+Tree</code></strong> 作为索引的结构。 但是具体的实现不一样。</p><ul><li><p><strong>InnoDB的数据文件本身就是索引文件</strong></p><p>MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。</p><p><img src=https://box.kancloud.cn/2015-07-07_559b7873b514d.png alt=图></p><p>从上图可以看出叶子节点包含了完整的数据记录。这种索引叫做 <strong>聚集索引</strong> 。因为 <strong><code>InnoDB</code></strong> 的数据文件本身要按主键聚集，所以 <strong><code>InnoDB</code></strong> 要求表必须有主键（MyISAM可以没有）。所以在建表的过程中会要求我们选择一列作为主键。</p><p>第二个与MyISAM索引的不同是<strong>InnoDB的辅助索引data域存储相应记录主键的值而不是地址</strong> 。换句话说，InnoDB的所有辅助索引都引用主键作为data域。</p><p><img src=https://box.kancloud.cn/2015-07-07_559b7873ceaf1.png alt=图></p><p><strong>辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。</strong> 为什么不建议使用过长的字段作为主键：辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。</p></li></ul></li></ul><p>参考：</p><ul><li><a href=https://www.kancloud.cn/kancloud/theory-of-mysql-index/41851>https://www.kancloud.cn/kancloud/theory-of-mysql-index/41851</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b2fc20b51acddf5ec8ad59e51421b5c9>7 - MySQL的优化</h1><h3 id=1-mysql优化的三个方面>1. MySQL优化的三个方面</h3><ul><li><h4 id=索引优化>索引优化</h4></li><li><h4 id=表结构的优化>表结构的优化</h4></li><li><h4 id=sql慢查询的优化>SQL慢查询的优化</h4></li></ul><p><img src="https://github.com/mxsm/document/blob/master/image/database/MySQL%E7%9A%84%E4%BC%98%E5%8C%96%E4%B8%89%E4%B8%AA%E6%96%B9%E9%9D%A2.jpg?raw=true" alt=图></p><h3 id=2-索引优化>2. 索引优化</h3><h4 id=21什么是索引>2.1什么是索引</h4><p>索引：简单的说，相当于图书的目录，可以帮助用户快速的找到需要的内容。索引的目的在于提高查询效率，与我们查询图书所用的目录是一个道理：先定位到章，然后定位到该章下的一个小结，然后找到页数。相似的例子还有：查字典，查地图等。</p><h4 id=22-索引的类型>2.2 索引的类型</h4><ul><li><p><strong>普通索引</strong></p><pre><code>是最基本的索引，它没有任何限制。
</code></pre></li><li><p><strong>唯一索引</strong></p><pre><code>与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。
</code></pre></li><li><p><strong>组合索引</strong></p><pre><code>指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。
</code></pre></li><li><p><strong>主键索引</strong></p><pre><code>是一种特殊的唯一索引，一个表只能有一个主键，不允许有空值。一般是在建表的时候同时创建主键索引
</code></pre></li><li><p><strong>全文索引(InnoDB不支持)</strong></p><pre><code>主要用来查找文本中的关键字，而不是直接与索引中的值相比较。fulltext索引跟其它索引大不相同，它更像是一个搜
索引擎，而不是简单的where语句的参数匹配。fulltext索引配合match against操作使用，而不是一般的where语
句加like。它可以在create table，alter table ，create index使用，不过目前只有char、varchar，text
列上可以创建全文索引。值得一提的是，在数据量较大时候，现将数据放入一个没有全局索引的表中，然后再用CREATE 
index创建fulltext索引，要比先为一张表建立fulltext然后再将数据写入的速度快很多。
</code></pre></li></ul><h4 id=23-索引的优化>2.3 索引的优化</h4><ul><li>只要列中含有NULL值，就最好不要在此例设置索引，复合索引如果有NULL值，此列在使用时也不会使用索引。(所以在建表的过程中尽可能的不要有NULL的字段，设置相应的默认值)</li><li>尽量使用短索引，如果可以，应该制定一个前缀长度</li><li>对于经常在where子句使用的列，最好设置索引，这样会加快查找速度</li><li>对于有多个列where或者order by子句的，应该建立复合索引(这个应该是在开发后期页面展示的视图基本上确定了)</li><li>对于like语句，以%或者‘-’开头的不会使用索引，以%结尾会使用索引</li><li>尽量不要在列上进行运算（函数操作和表达式操作）(比如 <strong><code>from_unixtime(create_time) = ’2014-05-29’</code></strong> 这样的操作应该尽量避免，但是可以写成下面这样 <strong><code>create_time= unix_timestamp(’2014-05-29’)</code></strong>)</li><li>尽量不要使用not in和&lt;>操作</li></ul><h3 id=3-sql慢查询优化>3. SQL慢查询优化</h3><p>SQL慢查询优化的步骤：</p><p><img src="https://github.com/mxsm/document/blob/master/image/database/SQL%E6%85%A2%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%AD%A5%E9%AA%A4.jpg?raw=true" alt=图></p><h4 id=31-如何捕获低效sql>3.1 如何捕获低效SQL</h4><ul><li><p><strong>slow_query_log</strong></p><p>这个参数设置为ON，可以捕获执行时间超过一定数值的SQL语句。</p></li><li><p><strong>long_query_time</strong></p><p>当SQL语句执行时间超过此数值时，就会被记录到日志中，建议设置为1或者更短</p></li><li><p><strong>slow_query_log_file</strong></p><p>记录日志的文件名。</p></li><li><p><strong>log_queries_not_using_indexes</strong></p><p>这个参数设置为ON，可以捕获到所有未使用索引的SQL语句，尽管这个SQL语句有可能执行得挺快。</p></li></ul><h4 id=32-慢查询优化的基本步骤>3.2 慢查询优化的基本步骤</h4><ul><li><p><strong>先运行看看是否真的很慢，注意设置SQL_NO_CACHE</strong></p><p>SELECT SQL_NO_CACHE yz_id FROM dev_item_backlog WHERE yz_id NOT IN (&lsquo;xZeT3PHc&rsquo;,&lsquo;WcUVNWEq&rsquo;);</p></li><li><p><strong>where条件单表查，锁定最小返回记录表</strong></p><p>查询语句的where都应用到表中返回的记录数最小的表开始查起，单表每个字段分别查询，看哪个字段的区分度最高</p></li><li><p><strong>explain查看执行计划</strong></p></li><li><p><strong>order by limit 形式的sql语句让排序的表优先查</strong></p></li><li><p><strong>加索引时参照建索引的几大原则</strong></p></li></ul><h4 id=33-优化原则>3.3 优化原则</h4><ul><li>*<em>查询时，能不要 * 就不用 <em>，尽量写全字段名</em></em></li><li><strong>大部分情况连接效率远大于子查询换一句话说就是 少用子查询</strong></li><li><strong>多使用explain和profile分析查询语句</strong></li><li><strong>查看慢查询日志，找出执行时间长的sql语句优化</strong></li><li><strong>多表连接时，尽量小表驱动大表，即小表 join 大表</strong></li><li><strong>在千万级分页时使用limit</strong></li><li><strong>对于经常使用的查询，可以开启缓存</strong></li></ul><h3 id=4-数据库表的优化>4. 数据库表的优化</h3><ul><li><p><strong>表的字段尽可能用NOT NULL，或者是最好字段都不存在NULL。因为NULL不走索引。所以最好设置非NULL的默认值</strong></p></li><li><p><strong>将表拆分，垂直拆分或者水平拆分</strong></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-660f64ff0579f3e10fffc1e77700b899>8 - MySQL主从复制原理</h1><h3 id=1-mysql的主从形式>1. MySQL的主从形式</h3><ul><li><p><strong>一主一从</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E.jpg?raw=true" alt=图></p></li><li><p><strong>一主多从</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E.jpg?raw=true" alt=图></p><p>一主一从和一主多从是最常见的主从架构，实施起来简单并且有效，不仅可以实现HA，而且还能读写分离，进而提升集群的并发能力。</p></li><li><p><strong>多主一从(5.7开始支持)</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/%E5%A4%9A%E4%B8%BB%E4%B8%80%E4%BB%8E.jpg?raw=true" alt=图></p><p>多主一从可以将多个mysql数据库备份到一台存储性能比较好的服务器上</p></li><li><p><strong>双主复制</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6.jpg?raw=true" alt=图></p><p>双主复制，也就是互做主从复制，每个master既是master，又是另外一台服务器的slave。这样任何一方所做的变更，都会通过复制应用到另外一方的数据库中。</p></li><li><p><strong>级联复制</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/database/%E7%BA%A7%E8%81%94%E5%A4%8D%E5%88%B6.jpg?raw=true" alt=图></p><p>级联复制模式下，部分slave的数据同步不连接主节点，而是连接从节点。因为如果主节点有太多的从节点，就会损耗一部分性能用于replication，其它从节点作为二级或者三级与从节点连接，好处：<strong>缓解主节点的压力，并且对数据一致性没有负面影响。</strong></p></li></ul><h3 id=2-主从复制的原理>2. 主从复制的原理</h3><p><img src="https://github.com/mxsm/document/blob/master/image/database/masterslave%E5%8E%9F%E7%90%86%E5%9B%BE.jpg?raw=true" alt=图></p><ul><li>当从节点连接主节点时，主节点会创建一个log dump 线程，用于发送bin-log的内容。在读取bin-log中的操作时，此线程会对主节点上的bin-log加锁，当读取完成，甚至在发动给从节点之前，锁会被释放。</li><li>当从节点上执行<code>start slave</code>命令之后，从节点会创建一个I/O线程用来连接主节点，请求主库中更新的bin-log。I/O线程接收到主节点binlog dump 进程发来的更新之后，保存在本地relay-log中。(这个线程不会对事件进行轮询。如果该线程追赶上了主库，他将进入睡眠状态，知道主库发送信号量通知其有新的事件产生时才会被唤醒)</li><li>SQL线程负责读取relay log中的内容，解析成具体的操作并执行，最终保证主从数据的一致性。</li></ul><blockquote><ol><li>在主库上把数据更改记录到二进制日志(Binary Log)中。</li><li>备库将主库上的日志复制到自己的中继日志(Relay Log)中</li><li>备库读取中继日志中的实践，将其重放到备库数据之上</li></ol></blockquote></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://groups.google.com/u/1/g/ljbmxsm><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=个人掘金主页 aria-label=个人掘金主页><a class=text-white target=_blank rel="noopener noreferrer" href=https://juejin.cn/user/1151943918492855><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/mxsm><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>隐私政策</a></small><p class=mt-2><a href=/about/>Home</a></p></div></div></div></footer><div><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><script>$("p img").wrap(function(){return'<a data-fancybox="gallery" href="'+$(this).attr('src')+'"></a>'})</script></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@8.8.1/dist/mermaid.min.js integrity=sha384-to2w0I1OqmbJ9J6yTnIX+KYU8grNpZoD1dKPLjgEJvMe5L5+/7qvuNa2sQo8WAWj crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js integrity="sha512-tBzZQxySO5q5lqwLWfu8Q+o4VkTcRGOeQGVQ0ueJga4A1RKuzmAu5HXDOXLEjpbKyV7ow9ympVoa6wZLEzRzDg==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.15.0/flowchart.min.js integrity="sha512-6QsSiIybtf8tuZ6xfjRTr2tdtw3Gp4q5RSCh2b6q9seoKEQmhAG1RrCA8F0kXTwivVxRVbp/YF3zOh8rvEAU7Q==" crossorigin=anonymous></script><script src=/js/main.min.b541b310f01941a0abfd76b652b5fb60dac470573775bb5b31ff08fe3f6cea51.js integrity="sha256-tUGzEPAZQaCr/Xa2UrX7YNrEcFc3dbtbMf8I/j9s6lE=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({appId:'JO2SY3WDAC',apiKey:'324ddb3b679c1308e5aa8bf222e07f8b',indexName:'mxsm',inputSelector:'.td-search-input',debug:!1})</script></body></html>