"use strict";(self.webpackChunkmxsm_website=self.webpackChunkmxsm_website||[]).push([[2354],{3726:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>i});var r=n(4848),s=n(8453);const a={title:"RequestMappingHandlerAdapter\u6e90\u7801\u5206\u6790",date:new Date("2018-04-09T00:00:00.000Z")},o=void 0,l={id:"spring/spring-framework/web-source-analysis/RequestMappingHandlerAdapter",title:"RequestMappingHandlerAdapter\u6e90\u7801\u5206\u6790",description:"1. RequestMappingHandlerAdapter\u521d\u59cb\u5316",source:"@site/docs/spring/spring-framework/web-source-analysis/RequestMappingHandlerAdapter.md",sourceDirName:"spring/spring-framework/web-source-analysis",slug:"/spring/spring-framework/web-source-analysis/RequestMappingHandlerAdapter",permalink:"/docs/spring/spring-framework/web-source-analysis/RequestMappingHandlerAdapter",draft:!1,unlisted:!1,editUrl:"https://github.com/mxsm/mxsm-website/edit/develop/docs/spring/spring-framework/web-source-analysis/RequestMappingHandlerAdapter.md",tags:[],version:"current",lastUpdatedBy:"mxsm",lastUpdatedAt:1728574453e3,frontMatter:{title:"RequestMappingHandlerAdapter\u6e90\u7801\u5206\u6790",date:"2018-04-09T00:00:00.000Z"},sidebar:"springframework",previous:{title:"DispatcherServlet\u6e90\u7801\u89e3\u6790",permalink:"/docs/spring/spring-framework/web-source-analysis/DispatcherServlet"},next:{title:"\u6df1\u5165\u4e86\u89e3WebApplicationInitializer\u662f\u6d88\u9664web.xml\u548cspringMVC\u7684\u914d\u7f6e\u6587\u4ef6",permalink:"/docs/spring/spring-framework/web-source-analysis/WebApplicationInitializer-eliminate-xml"}},d={},i=[{value:"1. RequestMappingHandlerAdapter\u521d\u59cb\u5316",id:"1-requestmappinghandleradapter\u521d\u59cb\u5316",level:3}];function u(e){const t={code:"code",em:"em",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h3,{id:"1-requestmappinghandleradapter\u521d\u59cb\u5316",children:"1. RequestMappingHandlerAdapter\u521d\u59cb\u5316"}),"\n",(0,r.jsx)(t.p,{children:"\u9996\u5148\u770b\u4e00\u4e0b\u6784\u9020\u51fd\u6570"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"public RequestMappingHandlerAdapter() {\n\t\tthis.messageConverters = new ArrayList<>(4);\n\t\tthis.messageConverters.add(new ByteArrayHttpMessageConverter());\n\t\tthis.messageConverters.add(new StringHttpMessageConverter());\n\t\ttry {\n\t\t\tthis.messageConverters.add(new SourceHttpMessageConverter<>());\n\t\t}\n\t\tcatch (Error err) {\n\t\t\t// Ignore when no TransformerFactory implementation is available\n\t\t}\n\t\tthis.messageConverters.add(new AllEncompassingFormHttpMessageConverter());\n\t}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["\u6784\u9020\u51fd\u6570\u4e3b\u8981\u521d\u59cb\u5316\u4e86\u56db\u4e2a ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"HttpMessageConverter"})})," \u3002\u7531\u4e8e\u5b9e\u73b0\u4e86 ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"InitializingBean"})})," \u63a5\u53e3\u4e0b\u9762\u6765\u770b ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"afterPropertiesSet"})})," \u65b9\u6cd5\u4e2d\u7684\u5b9e\u73b0\u3002"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"    @Override\n\tpublic void afterPropertiesSet() {\n\t\t// \u5904\u7406ControllerAdvice\u6ce8\u89e3\n\t\tinitControllerAdviceCache();\n\n        //\u53c2\u6570\u89e3\u6790\u5668\u521d\u59cb\u5316\n\t\tif (this.argumentResolvers == null) {\n\t\t\tList<HandlerMethodArgumentResolver> resolvers = getDefaultArgumentResolvers();\n\t\t\tthis.argumentResolvers = new HandlerMethodArgumentResolverComposite().addResolvers(resolvers);\n\t\t}\n\t\t\n\t\t//\u521d\u59cb\u5316\u7ed1\u5b9a\u53c2\u6570\u89e3\u6790\u5668--\u8ddfServlet\u76f8\u5173\u7684InitBinder\u6ce8\u89e3\n\t\tif (this.initBinderArgumentResolvers == null) {\n\t\t\tList<HandlerMethodArgumentResolver> resolvers = getDefaultInitBinderArgumentResolvers();\n\t\t\tthis.initBinderArgumentResolvers = new HandlerMethodArgumentResolverComposite().addResolvers(resolvers);\n\t\t}\n\t\t\n\t\t//\u8fd4\u56de\u503c\u53c2\u6570\u89e3\u6790\n\t\tif (this.returnValueHandlers == null) {\n\t\t\tList<HandlerMethodReturnValueHandler> handlers = getDefaultReturnValueHandlers();\n\t\t\tthis.returnValueHandlers = new HandlerMethodReturnValueHandlerComposite().addHandlers(handlers);\n\t\t}\n\t}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"initControllerAdviceCache"})})," \u65b9\u6cd5\u4e3b\u8981\u7528\u6765\u5904\u7406\u5305\u542b ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"@ControllerAdvice"})})," \u6ce8\u89e3(@ControllerAdvice\u6216\u8005@RestControllerAdvice)"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'private void initControllerAdviceCache() {\n\t\tif (getApplicationContext() == null) {\n\t\t\treturn;\n\t\t}\n        //\u83b7\u53d6\u5e26\u6709@ControllerAdvice\u6ce8\u89e3\u7684bean\n\t\tList<ControllerAdviceBean> adviceBeans = ControllerAdviceBean.findAnnotatedBeans(getApplicationContext());\n\n\t\tList<Object> requestResponseBodyAdviceBeans = new ArrayList<>();\n\n\t\tfor (ControllerAdviceBean adviceBean : adviceBeans) {\n\t\t\tClass<?> beanType = adviceBean.getBeanType();\n\t\t\tif (beanType == null) {\n\t\t\t\tthrow new IllegalStateException("Unresolvable type for ControllerAdviceBean: " + adviceBean);\n\t\t\t}\n\t\t\tSet<Method> attrMethods = MethodIntrospector.selectMethods(beanType, MODEL_ATTRIBUTE_METHODS);\n\t\t\tif (!attrMethods.isEmpty()) {\n\t\t\t\tthis.modelAttributeAdviceCache.put(adviceBean, attrMethods);\n\t\t\t}\n\t\t\tSet<Method> binderMethods = MethodIntrospector.selectMethods(beanType, INIT_BINDER_METHODS);\n\t\t\tif (!binderMethods.isEmpty()) {\n\t\t\t\tthis.initBinderAdviceCache.put(adviceBean, binderMethods);\n\t\t\t}\n\t\t\t//RequestBodyAdvice\u63a5\u53e3\u548cResponseBodyAdvice\u63a5\u53e3\n\t\t\tif (RequestBodyAdvice.class.isAssignableFrom(beanType) || ResponseBodyAdvice.class.isAssignableFrom(beanType)) {\n\t\t\t\trequestResponseBodyAdviceBeans.add(adviceBean);\n\t\t\t}\n\t\t}\n\n\t\tif (!requestResponseBodyAdviceBeans.isEmpty()) {\n\t\t\tthis.requestResponseBodyAdvice.addAll(0, requestResponseBodyAdviceBeans);\n\t\t}\n\t\t//\u7701\u7565\u65e5\u5fd7\u6253\u5370\n\t}\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"getDefaultArgumentResolvers"})})," \u65b9\u6cd5\u83b7\u53d6\u65b9\u6cd5\u53c2\u6570\u89e3\u6790\u5668\uff0c\u8fd9\u4e9b\u4e3b\u8981\u7528\u6765\u5904\u7406Controller\u7684\u65b9\u6cd5\u7684\u89e3\u6790\uff0c\u6784\u9020 ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"HandlerMethodArgumentResolverComposite"})})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"private List<HandlerMethodArgumentResolver> getDefaultArgumentResolvers() {\n\t\tList<HandlerMethodArgumentResolver> resolvers = new ArrayList<>();\n\n\t\t// \u5904\u7406RequestParam\u6ce8\u89e3\n\t\tresolvers.add(new RequestParamMethodArgumentResolver(getBeanFactory(), false));\n\t\t//\u5904\u7406RequestParam\u6ce8\u89e3\u53c2\u6570\u4e3aMap\n\t\tresolvers.add(new RequestParamMapMethodArgumentResolver());\n\t\t//\u5904\u7406PathVariable\u6ce8\u89e3\n\t\tresolvers.add(new PathVariableMethodArgumentResolver());\n\t\t//\u5904\u7406PathVariable\u6ce8\u89e3 \u53c2\u6570\u4e3aMap\n\t\tresolvers.add(new PathVariableMapMethodArgumentResolver());\n\t\t//\u5904\u7406MatrixVariable\u6ce8\u89e3\n\t\tresolvers.add(new MatrixVariableMethodArgumentResolver());\n\t\t//\u5904\u7406MatrixVariable\u6ce8\u89e3 \u53c2\u6570\u4e3aMap\n\t\tresolvers.add(new MatrixVariableMapMethodArgumentResolver());\n\t\tresolvers.add(new ServletModelAttributeMethodProcessor(false));\n\t\tresolvers.add(new RequestResponseBodyMethodProcessor(getMessageConverters(), this.requestResponseBodyAdvice));\n\t\tresolvers.add(new RequestPartMethodArgumentResolver(getMessageConverters(), this.requestResponseBodyAdvice));\n\t\tresolvers.add(new RequestHeaderMethodArgumentResolver(getBeanFactory()));\n\t\tresolvers.add(new RequestHeaderMapMethodArgumentResolver());\n\t\tresolvers.add(new ServletCookieValueMethodArgumentResolver(getBeanFactory()));\n\t\tresolvers.add(new ExpressionValueMethodArgumentResolver(getBeanFactory()));\n\t\tresolvers.add(new SessionAttributeMethodArgumentResolver());\n\t\tresolvers.add(new RequestAttributeMethodArgumentResolver());\n\t\t\n\t\t// \u57fa\u672c\u7c7b\u578b\u89e3\u51b3\n\t\tresolvers.add(new ServletRequestMethodArgumentResolver());\n\t\tresolvers.add(new ServletResponseMethodArgumentResolver());\n\t\tresolvers.add(new HttpEntityMethodProcessor(getMessageConverters(), this.requestResponseBodyAdvice));\n\t\tresolvers.add(new RedirectAttributesMethodArgumentResolver());\n\t\tresolvers.add(new ModelMethodProcessor());\n\t\tresolvers.add(new MapMethodProcessor());\n\t\tresolvers.add(new ErrorsMethodArgumentResolver());\n\t\tresolvers.add(new SessionStatusMethodArgumentResolver());\n\t\tresolvers.add(new UriComponentsBuilderMethodArgumentResolver());\n\n\t\t// \u81ea\u5b9a\u4e49\u89e3\u51b3\u5668\n\t\tif (getCustomArgumentResolvers() != null) {\n\t\t\tresolvers.addAll(getCustomArgumentResolvers());\n\t\t}\n\n\t\t// \u8bbe\u7f6e\u9ed8\u8ba4\u89e3\u51b3\u5668\n\t\tresolvers.add(new RequestParamMethodArgumentResolver(getBeanFactory(), true));\n\t\tresolvers.add(new ServletModelAttributeMethodProcessor(true));\n\n\t\treturn resolvers;\n\t}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"getDefaultInitBinderArgumentResolvers"})})," \u7ed1\u5b9a\u7684\u662f ",(0,r.jsxs)(t.strong,{children:["@",(0,r.jsx)(t.em,{children:"InitBinder"})]})," \u5904\u7406\u3002"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"\tprivate List<HandlerMethodArgumentResolver> getDefaultInitBinderArgumentResolvers() {\n\t\tList<HandlerMethodArgumentResolver> resolvers = new ArrayList<>();\n\n\t\t// \u57fa\u672c\u6ce8\u89e3\u7684\u53c2\u6570\u7684\u89e3\u51b3\n\t\tresolvers.add(new RequestParamMethodArgumentResolver(getBeanFactory(), false));\n\t\tresolvers.add(new RequestParamMapMethodArgumentResolver());\n\t\tresolvers.add(new PathVariableMethodArgumentResolver());\n\t\tresolvers.add(new PathVariableMapMethodArgumentResolver());\n\t\tresolvers.add(new MatrixVariableMethodArgumentResolver());\n\t\tresolvers.add(new MatrixVariableMapMethodArgumentResolver());\n\t\tresolvers.add(new ExpressionValueMethodArgumentResolver(getBeanFactory()));\n\t\tresolvers.add(new SessionAttributeMethodArgumentResolver());\n\t\tresolvers.add(new RequestAttributeMethodArgumentResolver());\n\n\t\t// \u57fa\u672c\u7c7b\u578b\u7684\u53c2\u6570\u89e3\u51b3\n\t\tresolvers.add(new ServletRequestMethodArgumentResolver());\n\t\tresolvers.add(new ServletResponseMethodArgumentResolver());\n\n\t\t// Custom arguments\n\t\tif (getCustomArgumentResolvers() != null) {\n\t\t\tresolvers.addAll(getCustomArgumentResolvers());\n\t\t}\n\n\t\t// Catch-all\n\t\tresolvers.add(new RequestParamMethodArgumentResolver(getBeanFactory(), true));\n\n\t\treturn resolvers;\n\t}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"getDefaultReturnValueHandlers"})})," \u8fd4\u56de\u503c\u7684\u5904\u7406\u3002"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"private List<HandlerMethodReturnValueHandler> getDefaultReturnValueHandlers() {\n\t\tList<HandlerMethodReturnValueHandler> handlers = new ArrayList<>();\n\n\t\t// \u5355\u4e00\u7684\u8fd4\u56de\u503c\u7c7b\u578b\n\t\thandlers.add(new ModelAndViewMethodReturnValueHandler());\n\t\thandlers.add(new ModelMethodProcessor());\n\t\thandlers.add(new ViewMethodReturnValueHandler());\n\t\thandlers.add(new ResponseBodyEmitterReturnValueHandler(getMessageConverters(),\n\t\t\t\tthis.reactiveAdapterRegistry, this.taskExecutor, this.contentNegotiationManager));\n\t\thandlers.add(new StreamingResponseBodyReturnValueHandler());\n\t\thandlers.add(new HttpEntityMethodProcessor(getMessageConverters(),\n\t\t\t\tthis.contentNegotiationManager, this.requestResponseBodyAdvice));\n\t\thandlers.add(new HttpHeadersReturnValueHandler());\n\t\thandlers.add(new CallableMethodReturnValueHandler());\n\t\thandlers.add(new DeferredResultMethodReturnValueHandler());\n\t\thandlers.add(new AsyncTaskMethodReturnValueHandler(this.beanFactory));\n\t   // \u57fa\u672c\u6ce8\u89e3\u7c7b\u578b\u8fd4\u56de\u503c\n\t\thandlers.add(new ModelAttributeMethodProcessor(false));\n\t\t//\u8fd9\u4e2a\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e00\u4e0b--ResponseBody\u6ce8\u89e3\n\t\thandlers.add(new RequestResponseBodyMethodProcessor(getMessageConverters(),\n\t\t\t\tthis.contentNegotiationManager, this.requestResponseBodyAdvice));\n\n\t\t// \u591a\u503c\u8fd4\u56de\u503c\u7c7b\u578b\n\t\thandlers.add(new ViewNameMethodReturnValueHandler());\n\t\thandlers.add(new MapMethodProcessor());\n\n\t\t// \u81ea\u5b9a\u4e49\u8fd4\u56de\u503c\n\t\tif (getCustomReturnValueHandlers() != null) {\n\t\t\thandlers.addAll(getCustomReturnValueHandlers());\n\t\t}\n\n\t\t// Catch-all\n\t\tif (!CollectionUtils.isEmpty(getModelAndViewResolvers())) {\n\t\t\thandlers.add(new ModelAndViewResolverMethodReturnValueHandler(getModelAndViewResolvers()));\n\t\t}\n\t\telse {\n\t\t\thandlers.add(new ModelAttributeMethodProcessor(true));\n\t\t}\n\n\t\treturn handlers;\n\t}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"invokeHandlerMethod"})})," \u5904\u7406\u8bf7\u6c42\u7684\u6570\u636e"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'    @Nullable\n\tprotected ModelAndView invokeHandlerMethod(HttpServletRequest request,\n\t\t\tHttpServletResponse response, HandlerMethod handlerMethod) throws Exception {\n\n\t\tServletWebRequest webRequest = new ServletWebRequest(request, response);\n\t\ttry {\n\t\t\tWebDataBinderFactory binderFactory = getDataBinderFactory(handlerMethod);\n\t\t\tModelFactory modelFactory = getModelFactory(handlerMethod, binderFactory);\n            //\u901a\u8fc7ServletInvocableHandlerMethod\u6765\u6267\u884c\n\t\t\tServletInvocableHandlerMethod invocableMethod = createInvocableHandlerMethod(handlerMethod);\n\t\t\t\n\t\t\t//\u8bbe\u7f6eController\u65b9\u6cd5\u7684\u5904\u7406\u5668\n\t\t\tif (this.argumentResolvers != null) {\n\t\t\t\tinvocableMethod.setHandlerMethodArgumentResolvers(this.argumentResolvers);\n\t\t\t}\n\t\t\t\n\t\t\t//\u8bbe\u7f6eController\u8fd4\u56de\u503c\u5904\u7406\u5668\n\t\t\tif (this.returnValueHandlers != null) {\n\t\t\t\tinvocableMethod.setHandlerMethodReturnValueHandlers(this.returnValueHandlers);\n\t\t\t}\n\t\t\tinvocableMethod.setDataBinderFactory(binderFactory);\n\t\t\tinvocableMethod.setParameterNameDiscoverer(this.parameterNameDiscoverer);\n\n\t\t\tModelAndViewContainer mavContainer = new ModelAndViewContainer();\n\t\t\tmavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));\n\t\t\tmodelFactory.initModel(webRequest, mavContainer, invocableMethod);\n\t\t\tmavContainer.setIgnoreDefaultModelOnRedirect(this.ignoreDefaultModelOnRedirect);\n\n\t\t\tAsyncWebRequest asyncWebRequest = WebAsyncUtils.createAsyncWebRequest(request, response);\n\t\t\tasyncWebRequest.setTimeout(this.asyncRequestTimeout);\n\t\t\tWebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n\t\t\tasyncManager.setTaskExecutor(this.taskExecutor);\n\t\t\tasyncManager.setAsyncWebRequest(asyncWebRequest);\n\t\t\tasyncManager.registerCallableInterceptors(this.callableInterceptors);\n\t\t\tasyncManager.registerDeferredResultInterceptors(this.deferredResultInterceptors);\n\n\t\t\tif (asyncManager.hasConcurrentResult()) {\n\t\t\t\tObject result = asyncManager.getConcurrentResult();\n\t\t\t\tmavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[0];\n\t\t\t\tasyncManager.clearConcurrentResult();\n\t\t\t\tLogFormatUtils.traceDebug(logger, traceOn -> {\n\t\t\t\t\tString formatted = LogFormatUtils.formatValue(result, !traceOn);\n\t\t\t\t\treturn "Resume with async result [" + formatted + "]";\n\t\t\t\t});\n\t\t\t\tinvocableMethod = invocableMethod.wrapConcurrentResult(result);\n\t\t\t}\n            //\u5904\u7406\u6570\u636e\n\t\t\tinvocableMethod.invokeAndHandle(webRequest, mavContainer);\n\t\t\tif (asyncManager.isConcurrentHandlingStarted()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn getModelAndView(mavContainer, modelFactory, webRequest);\n\t\t}\n\t\tfinally {\n\t\t\twebRequest.requestCompleted();\n\t\t}\n\t}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["\u6700\u540e\u7684\u5904\u7406\u4e3b\u8981\u901a\u8fc7 ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"ServletInvocableHandlerMethod"})})," \u6765\u5904\u7406\u3002\u4e0b\u9762\u6765\u5206\u6790\u4e00\u4e0b\u65b9\u6cd5 ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"invokeAndHandle"})})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'public void invokeAndHandle(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,\n\t\t\tObject... providedArgs) throws Exception {\n\t\t\t\n        //\u6267\u884cController\u65b9\u6cd5\u8fd4\u56de\u503c\n\t\tObject returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);\n\t\tsetResponseStatus(webRequest);\n\n\t\tif (returnValue == null) {\n\t\t\tif (isRequestNotModified(webRequest) || getResponseStatus() != null || mavContainer.isRequestHandled()) {\n\t\t\t\tdisableContentCachingIfNecessary(webRequest);\n\t\t\t\tmavContainer.setRequestHandled(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (StringUtils.hasText(getResponseStatusReason())) {\n\t\t\tmavContainer.setRequestHandled(true);\n\t\t\treturn;\n\t\t}\n\n\t\tmavContainer.setRequestHandled(false);\n\t\tAssert.state(this.returnValueHandlers != null, "No return value handlers");\n\t\ttry {\n\t\t    //\u5904\u7406\u8fd4\u56de\u503c\n\t\t\tthis.returnValueHandlers.handleReturnValue(\n\t\t\t\t\treturnValue, getReturnValueType(returnValue), mavContainer, webRequest);\n\t\t}\n\t\tcatch (Exception ex) {\n\t\t    //\u7701\u7565\u65e5\u5fd7\u6253\u5370\n\t\t\tthrow ex;\n\t\t}\n\t}\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"InvocableHandlerMethod#invokeForRequest"})})," \u5904\u7406\u8bf7\u6c42\u65b9\u6cd5\uff1a"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'\tpublic Object invokeForRequest(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,\n\t\t\tObject... providedArgs) throws Exception {\n        //\u5904\u7406Controller\u65b9\u6cd5\u7684\u53c2\u6570\u6570\u636e\u503c\n\t\tObject[] args = getMethodArgumentValues(request, mavContainer, providedArgs);\n\t    //\u6253\u5370\u65e5\u5fd7\u7701\u7565\n\t\treturn doInvoke(args);\n\t}\n\t\n\tprotected Object[] getMethodArgumentValues(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,\n\t\t\tObject... providedArgs) throws Exception {\n\n        //\u83b7\u53d6\u65b9\u6cd5\u7684\u53c2\u6570\n\t\tMethodParameter[] parameters = getMethodParameters();\n\t\tif (ObjectUtils.isEmpty(parameters)) {\n\t\t\treturn EMPTY_ARGS;\n\t\t}\n        \n\t\tObject[] args = new Object[parameters.length];\n\t\tfor (int i = 0; i < parameters.length; i++) {\n\t\t\tMethodParameter parameter = parameters[i];\n\t\t\tparameter.initParameterNameDiscovery(this.parameterNameDiscoverer);\n\t\t\targs[i] = findProvidedArgument(parameter, providedArgs);\n\t\t\tif (args[i] != null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t//\u5224\u65ad\u53c2\u6570\u662f\u5426\u652f\u6301--HandlerMethodArgumentResolver\u63a5\u53e3\n\t\t\tif (!this.resolvers.supportsParameter(parameter)) {\n\t\t\t\tthrow new IllegalStateException(formatArgumentError(parameter, "No suitable resolver"));\n\t\t\t}\n\t\t\ttry {\n\t\t\t    //\u6267\u884cHandlerMethodArgumentResolver#resolveArgument\u65b9\u6cd5\u5c06request\u4e2d\u7684\u8bf7\u6c42\u7684\u53c2\u6570\u8bbe\u7f6e\u5230Controller\u7684\u65b9\u6cd5\n\t\t\t    //\u8bbe\u7f6e\u5230\u53c2\u6570\u4e0a--\u8fd9\u91cc\u53ef\u4ee5\u81ea\u5b9a\u4e49\n\t\t\t\targs[i] = this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);\n\t\t\t}\n\t\t\tcatch (Exception ex) {\n\t\t\t    //\u7701\u7565\u65e5\u5fd7\u6253\u5370\n\t\t\t\tthrow ex;\n\t\t\t}\n\t\t}\n\t\treturn args;\n\t}\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u8fd4\u56de\u503c\u5904\u7406"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"this.returnValueHandlers.handleReturnValue(\n\t\t\t\t\treturnValue, getReturnValueType(returnValue), mavContainer, webRequest);\n"})}),"\n",(0,r.jsxs)(t.p,{children:["\u8fd4\u56de\u503c\u5904\u7406\u8c03\u7528\u7684\u662f\u590d\u5408\u7c7b ",(0,r.jsx)(t.em,{children:(0,r.jsx)(t.strong,{children:"HandlerMethodReturnValueHandlerComposite#handleReturnValue"})})," \u8fd9\u4e2a\u65b9\u6cd5\u3002"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'\t@Override\n\tpublic void handleReturnValue(@Nullable Object returnValue, MethodParameter returnType,\n\t\t\tModelAndViewContainer mavContainer, NativeWebRequest webRequest) throws Exception {\n        \n        //\u9009\u53d6\u5bf9\u5e94\u7684HandlerMethodReturnValueHandler\u7684\u5b9e\u73b0\u6765\u5904\u7406\n\t\tHandlerMethodReturnValueHandler handler = selectHandler(returnValue, returnType);\n\t\tif (handler == null) {\n\t\t\tthrow new IllegalArgumentException("Unknown return value type: " + returnType.getParameterType().getName());\n\t\t}\n\t\t//\u5904\u7406\u8fd4\u56de\u503c\n\t\thandler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);\n\t}\n'})})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>l});var r=n(6540);const s={},a=r.createContext(s);function o(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);