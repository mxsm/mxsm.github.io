"use strict";(self.webpackChunkmxsm_website=self.webpackChunkmxsm_website||[]).push([[9102],{4542:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>g});var t=i(4848),r=i(8453);const o={title:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bConfigurationProperties\u539f\u7406",linkeTitle:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bConfigurationProperties\u539f\u7406",weight:4,date:new Date("2020-01-16T00:00:00.000Z")},s=void 0,a={id:"spring/spring-boot/core-source-analysis/springboot-ConfigurationProperties",title:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bConfigurationProperties\u539f\u7406",description:"ConfigurationProperties\u7684\u4f5c\u7528",source:"@site/docs/spring/spring-boot/core-source-analysis/springboot-ConfigurationProperties.md",sourceDirName:"spring/spring-boot/core-source-analysis",slug:"/spring/spring-boot/core-source-analysis/springboot-ConfigurationProperties",permalink:"/docs/spring/spring-boot/core-source-analysis/springboot-ConfigurationProperties",draft:!1,unlisted:!1,editUrl:"https://github.com/mxsm/mxsm-website/edit/develop/docs/spring/spring-boot/core-source-analysis/springboot-ConfigurationProperties.md",tags:[],version:"current",lastUpdatedBy:"mxsm",lastUpdatedAt:1728574453e3,frontMatter:{title:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bConfigurationProperties\u539f\u7406",linkeTitle:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bConfigurationProperties\u539f\u7406",weight:4,date:"2020-01-16T00:00:00.000Z"},sidebar:"springboot",previous:{title:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bConditionalOnXXX",permalink:"/docs/spring/spring-boot/core-source-analysis/springboot-ConditionalOnXXX"},next:{title:"SpringBoot\u6e90\u7801\u89e3\u6790\u4e4bspring.factories\u914d\u7f6e-EnvironmentPostProcessor",permalink:"/docs/spring/spring-boot/core-source-analysis/springboot-EnvironmentPostProcessor"}},l={},g=[{value:"ConfigurationProperties\u7684\u4f5c\u7528",id:"configurationproperties\u7684\u4f5c\u7528",level:3},{value:"ConfigurationProperties\u6ce8\u89e3\u6e90\u7801\u89e3\u6790",id:"configurationproperties\u6ce8\u89e3\u6e90\u7801\u89e3\u6790",level:3},{value:"ConfigurationProperties\u6e90\u7801",id:"configurationproperties\u6e90\u7801",level:4},{value:"ConfigurationProperties\u6ce8\u89e3\u6fc0\u6d3b",id:"configurationproperties\u6ce8\u89e3\u6fc0\u6d3b",level:4},{value:"ConfigurationPropertiesBeanRegistrar\u6e90\u7801\u5206\u6790",id:"configurationpropertiesbeanregistrar\u6e90\u7801\u5206\u6790",level:4},{value:"ConfigurationPropertiesBindingPostProcessorRegistrar\u6e90\u7801\u5206\u6790",id:"configurationpropertiesbindingpostprocessorregistrar\u6e90\u7801\u5206\u6790",level:4},{value:"ConfigurationPropertiesBindingPostProcessor\u6e90\u7801\u5206\u6790",id:"configurationpropertiesbindingpostprocessor\u6e90\u7801\u5206\u6790",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:3}];function c(n){const e={br:"br",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h3,{id:"configurationproperties\u7684\u4f5c\u7528",children:"ConfigurationProperties\u7684\u4f5c\u7528"}),"\n",(0,t.jsx)(e.p,{children:"\u914d\u7f6e\u6587\u4ef6\u7684\u4fe1\u606f\uff0c\u8bfb\u53d6\u5e76\u81ea\u52a8\u5c01\u88c5\u6210\u5b9e\u4f53\u7c7b\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public class Bean {\n\n    private String name;\n    \n    private String user;\n    \n    private int age;\n\n   //\u7701\u7565get set \u65b9\u6cd5\n}\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"student:\n  name: 1111\n  user: bbbb\n  age: 11\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5bf9\u4e8e\u8fd9\u6837\u7684\u6570\u636e\u5c01\u88c5\u4e3aBean\u5c31\u9700\u8981\u7528\u5230@ConfigurationProperties\u6ce8\u89e3\u3002"}),"\n",(0,t.jsx)(e.h3,{id:"configurationproperties\u6ce8\u89e3\u6e90\u7801\u89e3\u6790",children:"ConfigurationProperties\u6ce8\u89e3\u6e90\u7801\u89e3\u6790"}),"\n",(0,t.jsx)(e.h4,{id:"configurationproperties\u6e90\u7801",children:"ConfigurationProperties\u6e90\u7801"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@Target({ ElementType.TYPE, ElementType.METHOD })\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface ConfigurationProperties {\n\n\t//\u524d\u7f00,\u591a\u4e2a\u7528\u9017\u53f7\u9694\u5f00\n\t@AliasFor("prefix")\n\tString value() default "";\n\n\t//\u524d\u7f00,\u591a\u4e2a\u7528\u9017\u53f7\u9694\u5f00\n\t@AliasFor("value")\n\tString prefix() default "";\n\n\t//\u662f\u5426\u5ffd\u7565\u4e0d\u53ef\u7528\u7684\u5b57\u6bb5\n\tboolean ignoreInvalidFields() default false;\n\n\t//\u662f\u5426\u5ffd\u7565Java\u7c7b\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5\n\tboolean ignoreUnknownFields() default true;\n\n}\n'})}),"\n",(0,t.jsx)(e.h4,{id:"configurationproperties\u6ce8\u89e3\u6fc0\u6d3b",children:"ConfigurationProperties\u6ce8\u89e3\u6fc0\u6d3b"}),"\n",(0,t.jsxs)(e.p,{children:["\u901a\u8fc7 ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"EnableConfigurationProperties"})})," \u6765\u5904\u7406\u6fc0\u6d3b ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"ConfigurationProperties"})})," \u6ce8\u89e3\u914d\u7f6e\u7684\u7c7b\u3002"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Import({ ConfigurationPropertiesBeanRegistrar.class, ConfigurationPropertiesBindingPostProcessorRegistrar.class })\npublic @interface EnableConfigurationProperties {\n\n\t//\u914d\u7f6e\u7528ConfigurationProperties\u6ce8\u89e3\u7684\u7c7b\n\tClass<?>[] value() default {};\n\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"EnableConfigurationProperties"})})," \u6ce8\u89e3\u88ab ",(0,t.jsx)(e.strong,{children:"@Import"})," \u5bfc\u5165\u4e24\u4e2a\u7c7b\u3002\u4e0b\u9762\u6765\u770b\u4e00\u4e0b\u8fd9\u4e24\u4e2a\u7c7b\u6e90\u7801\u5206\u6790\uff1a"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBeanRegistrar"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBindingPostProcessorRegistrar"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u90a3\u4e48\u89e3\u6790\u6765\u4e00\u4e00\u5206\u6790\u8fd9\u4e24\u4e2a\u7c7b\u3002"}),"\n",(0,t.jsx)(e.h4,{id:"configurationpropertiesbeanregistrar\u6e90\u7801\u5206\u6790",children:"ConfigurationPropertiesBeanRegistrar\u6e90\u7801\u5206\u6790"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'class ConfigurationPropertiesBeanRegistrar implements ImportBeanDefinitionRegistrar {\n\n\t@Override\n\tpublic void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) {\n\t\tConfigurableListableBeanFactory beanFactory = (ConfigurableListableBeanFactory) registry;\n\t\tgetTypes(metadata).forEach(\n\t\t\t\t(type) -> ConfigurationPropertiesBeanDefinitionRegistrar.register(registry, beanFactory, type));\n\t}\n\n\tprivate List<Class<?>> getTypes(AnnotationMetadata metadata) {\n\t\tMultiValueMap<String, Object> attributes = metadata\n\t\t\t\t.getAllAnnotationAttributes(EnableConfigurationProperties.class.getName(), false);\n\t\treturn collectClasses((attributes != null) ? attributes.get("value") : Collections.emptyList());\n\t}\n\n\tprivate List<Class<?>> collectClasses(List<?> values) {\n\t\treturn values.stream().flatMap((value) -> Arrays.stream((Class<?>[]) value))\n\t\t\t\t.filter((type) -> void.class != type).collect(Collectors.toList());\n\t}\n\n}\n'})}),"\n",(0,t.jsxs)(e.p,{children:["\u901a\u8fc7\u5206\u6790\u6e90\u7801\u53d1\u73b0 ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBeanRegistrar"})})," \u4e3b\u8981\u7684\u4f5c\u7528\u662f\u628a\u6ce8\u89e3 ",(0,t.jsx)(e.strong,{children:"EnableConfigurationProperties"})," \u4e2d\u7684 ",(0,t.jsx)(e.strong,{children:"value"})," \u4e2d\u914d\u7f6e\u7684 ",(0,t.jsx)(e.strong,{children:"Class"})," \u7684 ",(0,t.jsx)(e.strong,{children:"BeanDefinition"})," \u6ce8\u5165\u5230Spring\u4e2d\u3002\u8fd9\u4e2a\u5c31\u662f\u8fd9\u6837\u7684\u7b80\u5355\u3002\u90a3\u4e48\u89e3\u6790\u6765\u5206\u6790 ",(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBindingPostProcessorRegistrar"}),"\u3002"]}),"\n",(0,t.jsx)(e.h4,{id:"configurationpropertiesbindingpostprocessorregistrar\u6e90\u7801\u5206\u6790",children:"ConfigurationPropertiesBindingPostProcessorRegistrar\u6e90\u7801\u5206\u6790"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'public class ConfigurationPropertiesBindingPostProcessorRegistrar implements ImportBeanDefinitionRegistrar {\n\n\t/**\n\t * \u9a8c\u8bc1\u5668 bean\u7684\u540d\u79f0\n\t */\n\tpublic static final String VALIDATOR_BEAN_NAME = "configurationPropertiesValidator";\n\n\t@Override\n\tpublic void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n\t\tif (!registry.containsBeanDefinition(ConfigurationPropertiesBinder.BEAN_NAME)) {\n\t\t\tregisterConfigurationPropertiesBinder(registry);\n\t\t}\n\t\tif (!registry.containsBeanDefinition(ConfigurationPropertiesBindingPostProcessor.BEAN_NAME)) {\n\t\t\tregisterConfigurationPropertiesBindingPostProcessor(registry);\n\t\t\tregisterConfigurationBeanFactoryMetadata(registry);\n\t\t}\n\t}\n\n\t//\u6ce8\u5165ConfigurationPropertiesBinder\n\tprivate void registerConfigurationPropertiesBinder(BeanDefinitionRegistry registry) {\n\t\tGenericBeanDefinition definition = new GenericBeanDefinition();\n\t\tdefinition.setBeanClass(ConfigurationPropertiesBinder.class);\n\t\tdefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);\n\t\tdefinition.getConstructorArgumentValues().addIndexedArgumentValue(0, VALIDATOR_BEAN_NAME);\n\t\tregistry.registerBeanDefinition(ConfigurationPropertiesBinder.BEAN_NAME, definition);\n\t}\n\n\t//\u6ce8\u5165ConfigurationPropertiesBindingPostProcessor\n\tprivate void registerConfigurationPropertiesBindingPostProcessor(BeanDefinitionRegistry registry) {\n\t\tGenericBeanDefinition definition = new GenericBeanDefinition();\n\t\tdefinition.setBeanClass(ConfigurationPropertiesBindingPostProcessor.class);\n\t\tdefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);\n\t\tregistry.registerBeanDefinition(ConfigurationPropertiesBindingPostProcessor.BEAN_NAME, definition);\n\t}\n\n\t//\u6ce8\u5165ConfigurationBeanFactoryMetadata\n\tprivate void registerConfigurationBeanFactoryMetadata(BeanDefinitionRegistry registry) {\n\t\tGenericBeanDefinition definition = new GenericBeanDefinition();\n\t\tdefinition.setBeanClass(ConfigurationBeanFactoryMetadata.class);\n\t\tdefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);\n\t\tregistry.registerBeanDefinition(ConfigurationBeanFactoryMetadata.BEAN_NAME, definition);\n\t}\n\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:"\u4e0a\u9762\u7684\u4ee3\u7801\u6ce8\u5165\u4e86\u4e24\u4e2a\u5173\u952e\u7684\u7c7b\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBinder"}),(0,t.jsx)(e.br,{}),"\n","\u7531\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5c5e\u6027\u8f6c\u6362\u6210\u5bf9\u5e94\u7c7b"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBindingPostProcessor"}),(0,t.jsx)(e.br,{}),"\n","bean\u521d\u59cb\u5316\u7684\u5904\u7406"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u901a\u8fc7\u4e24\u4e2a\u7684\u914d\u5408\u6765\u5b9e\u73b0\u7684\u3002"}),"\n",(0,t.jsx)(e.h4,{id:"configurationpropertiesbindingpostprocessor\u6e90\u7801\u5206\u6790",children:"ConfigurationPropertiesBindingPostProcessor\u6e90\u7801\u5206\u6790"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"ConfigurationPropertiesBindingPostProcessor"})," \u8fd9\u4e2a\u4e3b\u8981\u662f\u5904\u7406Bean\u3002"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public class ConfigurationPropertiesBindingPostProcessor\n\t\timplements BeanPostProcessor, PriorityOrdered, ApplicationContextAware, InitializingBean {\n    \n\tprivate ConfigurationBeanFactoryMetadata beanFactoryMetadata;\n\n\tprivate ApplicationContext applicationContext;\n\n\tprivate ConfigurationPropertiesBinder configurationPropertiesBinder;\t \n\t\n\t//\u7701\u7565\u4ee3\u7801\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u5b9e\u73b0\u4e86 ",(0,t.jsx)(e.strong,{children:"BeanPostProcessor"})," \u8fd9\u4e2a\u63a5\u53e3\uff0c\u4e3b\u8981\u662f\u5904\u7406bean\u3002\u4e0b\u9762\u770b\u4e00\u4e0b\u8fd9\u4e2a\u63a5\u53e3\u7684\u4e3b\u8981\u65b9\u6cd5\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"@Override\n\tpublic Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n\t\t//bean\u7684\u5904\u7406--\u83b7\u53d6bean\u662f\u5426\u6709ConfigurationProperties\u914d\u7f6e\n\t\tConfigurationProperties annotation = getAnnotation(bean, beanName, ConfigurationProperties.class);\n\t\tif (annotation != null && !hasBeenBound(beanName)) {\n\t\t\tbind(bean, beanName, annotation);\n\t\t}\n\t\treturn bean;\n\t}\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u901a\u8fc7\u5224\u65adbean\u662f\u5426\u914d\u7f6e\u4e86ConfigurationProperties\u6ce8\u89e3\uff0c\u5982\u679c\u914d\u7f6e\u4e86\u5c31\u8c03\u7528 ",(0,t.jsx)(e.strong,{children:"bind"})," \u65b9\u6cd5\u3002\u4e0b\u9762\u6765\u770b\u4e00\u4e0bbind\u65b9\u6cd5\u6e90\u7801\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"\tprivate void bind(Object bean, String beanName, ConfigurationProperties annotation) {\n\t\tResolvableType type = getBeanType(bean, beanName);\n\t\tValidated validated = getAnnotation(bean, beanName, Validated.class);\n\t\tAnnotation[] annotations = (validated != null) ? new Annotation[] { annotation, validated }\n\t\t\t\t: new Annotation[] { annotation };\n\t\tBindable<?> target = Bindable.of(type).withExistingValue(bean).withAnnotations(annotations);\n\t\ttry {\n\t\t\tthis.configurationPropertiesBinder.bind(target);\n\t\t}\n\t\tcatch (Exception ex) {\n\t\t\tthrow new ConfigurationPropertiesBindException(beanName, bean.getClass(), annotation, ex);\n\t\t}\n\t}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u4e0a\u9762\u7684\u4ee3\u7801\u4e3b\u8981\u5c31\u5b9e\u73b0\u4e86\u914d\u7f6e\u3002"}),"\n",(0,t.jsx)(e.h3,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,t.jsx)(e.p,{children:"\u603b\u7ed3\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528\uff1a"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u7ed9bean\u914d\u7f6eConfigurationProperties"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u7528EnableConfigurationProperties\u6ce8\u89e3\u914d\u7f6e\u914d\u7f6eConfigurationProperties\u4e86bean\u7684class"})}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>a});var t=i(6540);const r={},o=t.createContext(r);function s(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);