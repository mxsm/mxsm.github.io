"use strict";(self.webpackChunkmxsm_website=self.webpackChunkmxsm_website||[]).push([[6972],{686:(s,r,e)=>{e.r(r),e.d(r,{assets:()=>a,contentTitle:()=>t,default:()=>g,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var n=e(4848),o=e(8453);const i={title:"Spring BeanFactoryPostProcessor\u6267\u884c\u987a\u5e8f",linkTitle:"Spring BeanFactoryPostProcessor\u6267\u884c\u987a\u5e8f",date:new Date("2022-02-01T00:00:00.000Z"),weight:202202011126},t=void 0,c={id:"spring/spring-framework/core-source-analysis/spring-BeanFactoryPostProcessor-order",title:"Spring BeanFactoryPostProcessor\u6267\u884c\u987a\u5e8f",description:"1. \u524d\u8a00",source:"@site/docs/spring/spring-framework/core-source-analysis/spring-BeanFactoryPostProcessor-order.md",sourceDirName:"spring/spring-framework/core-source-analysis",slug:"/spring/spring-framework/core-source-analysis/spring-BeanFactoryPostProcessor-order",permalink:"/docs/spring/spring-framework/core-source-analysis/spring-BeanFactoryPostProcessor-order",draft:!1,unlisted:!1,editUrl:"https://github.com/mxsm/mxsm-website/edit/develop/docs/spring/spring-framework/core-source-analysis/spring-BeanFactoryPostProcessor-order.md",tags:[],version:"current",lastUpdatedBy:"mxsm",lastUpdatedAt:1720344793e3,frontMatter:{title:"Spring BeanFactoryPostProcessor\u6267\u884c\u987a\u5e8f",linkTitle:"Spring BeanFactoryPostProcessor\u6267\u884c\u987a\u5e8f",date:"2022-02-01T00:00:00.000Z",weight:202202011126},sidebar:"springframework",previous:{title:"doGetBean\u6e90\u7801\u8be6\u89e3",permalink:"/docs/spring/spring-framework/core-source-analysis/doGetBean"},next:{title:"Spring BeanPostProcessor\u6267\u884c\u987a\u5e8f\u95ee\u9898",permalink:"/docs/spring/spring-framework/core-source-analysis/spring-BeanPostProcessor-order"}},a={},d=[{value:"1. \u524d\u8a00",id:"1-\u524d\u8a00",level:3},{value:"2.\u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f",id:"2\u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f",level:3},{value:"2.1 \u63a5\u53e3\u5b9e\u73b0\u7c7b\u5728\u54ea\u91cc\u6ce8\u5165\uff1f",id:"21-\u63a5\u53e3\u5b9e\u73b0\u7c7b\u5728\u54ea\u91cc\u6ce8\u5165",level:4},{value:"2.2 \u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f",id:"22-\u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f",level:4},{value:"3. \u603b\u7ed3",id:"3-\u603b\u7ed3",level:3}];function l(s){const r={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...s.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h3,{id:"1-\u524d\u8a00",children:"1. \u524d\u8a00"}),"\n",(0,n.jsxs)(r.p,{children:["\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u300a",(0,n.jsx)(r.a,{href:"https://blog.ljbmxsm.com/spring-framework/core-source-analysis/spring-beanpostprocessor-order/",children:"Spring BeanPostProcessor\u6267\u884c\u987a\u5e8f\u95ee\u9898"}),"\u300b\u4ecb\u7ecd\u8fc7 ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanPostProcessor"})})," \uff0c  \u4f7f\u7528Spring\u6846\u67b6\u7684\u4eba\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230\u8fd9\u6837\u4e00\u4e2a\u7c7b ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"})})," \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanPostProcessor"})}),"  \u540d\u79f0\u5f88\u63a5\u8fd1\u3002\u4e0b\u9762\u6765\u770b\u4e00\u4e0b**",(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"}),"** \u7684\u4f5c\u7528\u3002"]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor\uff1a"})," Spring Bean Factory\u7684\u524d\u7f6e\u5904\u7406\u5668\uff0c\u5141\u8bb8\u81ea\u5b9a\u4e49\u4fee\u6539\u5e94\u7528\u4e0a\u4e0b\u6587\u7684Bean\u7684\u5b9a\u4e49\u3002\u540c\u65f6\u53ef\u4ee5\u8c03\u6574\u4e0a\u4e0b\u6587\u7684\u5e95\u5c42bean\u5de5\u5382\u7684bean\u5c5e\u6027\u503c\u3002\u5e38\u7528\u7684\u62d3\u5c55\u63a5\u53e3\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8B%93%E5%B1%95%E6%8E%A5%E5%8F%A3%E7%B1%BB.png",alt:"\u5e38\u7528\u7684\u62d3\u5c55\u63a5\u53e3\u7c7b"})}),"\n",(0,n.jsx)(r.p,{children:"\u7c7b\u4e4b\u95f4\u7684\u7ee7\u627f\u5173\u7cfb\u5982\u4e0b\uff1a"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201120007663.png",alt:"image-20220201120007663"})}),"\n",(0,n.jsx)(r.p,{children:"\u4e0a\u9762\u5b58\u5728\u4e24\u4e2a\u91cd\u8981\u7684\u63a5\u53e3\uff1a"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessor"})}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"\u63a5\u4e0b\u6765\u7740\u91cd\u5206\u6790\u8fd9\u4e24\u4e2a\u63a5\u53e3\u7684\u4f5c\u7528"}),"\n",(0,n.jsx)(r.h3,{id:"2\u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f",children:"2.\u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f"}),"\n",(0,n.jsxs)(r.p,{children:["\u63a5\u4e0b\u6765\u4ece ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"})})," \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanDefinitionRegistryPostProcessor"})})," \u5b9e\u73b0\u7c7b\u6ce8\u5165\u548c\u6267\u884c\u987a\u5e8f\u6765\u770b\u3002"]}),"\n",(0,n.jsx)(r.h4,{id:"21-\u63a5\u53e3\u5b9e\u73b0\u7c7b\u5728\u54ea\u91cc\u6ce8\u5165",children:"2.1 \u63a5\u53e3\u5b9e\u73b0\u7c7b\u5728\u54ea\u91cc\u6ce8\u5165\uff1f"}),"\n",(0,n.jsxs)(r.p,{children:["\u7528\u73b0\u5728\u6700\u5e38\u7528\u7684\u6ce8\u89e3\u4e0a\u4e0b\u6587\u6765\u89e3\u6790\uff0c\u901a\u8fc7 ",(0,n.jsx)(r.strong,{children:"AnnotationConfigApplicationContext"})," \u6e90\u7801\u53d1\u73b0\uff0c\u5c5e\u6027 ",(0,n.jsx)(r.strong,{children:"AnnotatedBeanDefinitionReader"})," \u5b9e\u4f8b\u5316\u6709\u8fd9\u6837\u4e00\u6bb5\u4ee3\u7801\uff1a"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201123122834.png",alt:"image-20220201123122834"})}),"\n",(0,n.jsxs)(r.p,{children:["\u8ddf\u8fdb\u4ee3\u7801 ",(0,n.jsx)(r.strong,{children:"AnnotationConfigUtils#registerAnnotationConfigProcessors"})," \u53d1\u73b0"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201165201280.png",alt:"image-20220201165201280"})}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\u5c06 ",(0,n.jsx)(r.strong,{children:"ConfigurationClassPostProcessor"})," \u7c7b\u7684\u5b9a\u4e49\u6ce8\u518c\u5230\u4e86Spring\u5bb9\u5668\u4e2d\u3002"]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["\u5230\u8fd9\u91cc\u5c31\u662f ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"})})," \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanDefinitionRegistryPostProcessor"})}),"  \u7684\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u6ce8\u518c\u5230Spring\u5bb9\u5668"]}),"\n",(0,n.jsx)(r.h4,{id:"22-\u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f",children:"2.2 \u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f"}),"\n",(0,n.jsxs)(r.p,{children:["\u901a\u8fc7 ",(0,n.jsx)(r.strong,{children:"AnnotationConfigApplicationContext"})," \u6e90\u7801\u53d1\u73b0\u5728 refresh \u65b9\u6cd5\u4e2d\u6709\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor"})," \u3002\u6700\u7ec8\u8c03\u7528\u7684\u662f\u8c03\u7528\u4e86\u7236\u7c7b\u7684 ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"AbstractApplicationContext#refresh"})})," \u65b9\u6cd5\uff0c\u5728\u65b9\u6cd5\u4e2d\u6709\u8fd9\u6837\u4e00\u6bb5\u4ee3\u7801\uff1a"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201170035512.png",alt:"image-20220201170035512"})}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\u8fd9\u91cc\u5c31\u662f\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor"})]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["\u6211\u4eec\u770b\u4e00\u4e0b\u91cc\u9762 ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"})})," \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanDefinitionRegistryPostProcessor"})})," \u63a5\u53e3\u7684\u6267\u884c\u987a\u5e8f\uff0c\u5206\u6790\u6e90\u7801\u53ef\u4ee5\u77e5\u9053\u662f\u901a\u8fc7 ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors"})})," \u6765\u6267\u884c\uff0c\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6267\u884c\u90e8\u5206\uff1a"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"\u6267\u884cBeanDefinitionRegistryPostProcessor\uff1a"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u4eceSpring\u5bb9\u5668\u4e2d\u83b7\u53d6**",(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"}),"** \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanDefinitionRegistryPostProcessor"})})," \u7684\u5b9e\u73b0\u7c7b"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201170822680.png",alt:"image-20220201170822680"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"Tips: \u5982\u679c\u662fBeanDefinitionRegistryPostProcessor\u7684\u5b9e\u73b0\u7c7b\u540c\u65f6\u6267\u884cBeanDefinitionRegistryPostProcessor#postProcessBeanDefinitionRegistry\u65b9\u6cd5"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u9996\u5148\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessors#postProcessBeanDefinitionRegistry"})," \u5b9e\u73b0\u4e86 ",(0,n.jsx)(r.strong,{children:"PriorityOrdered"})," \u63a5\u53e3\u7684"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201173137323.png",alt:"image-20220201173137323"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u7136\u540e\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessors#postProcessBeanDefinitionRegistry"})," \u5b9e\u73b0\u4e86 ",(0,n.jsx)(r.strong,{children:"Ordered"})," \u63a5\u53e3\u7684"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201173224200.png",alt:"image-20220201173224200"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u5728\u6267\u884c\u5269\u4e0b\u7684 ",(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessors#postProcessBeanDefinitionRegistry"})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201173343336.png",alt:"image-20220201173343336"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u63a5\u7740\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessor#postProcessBeanFactory"})," \u65b9\u6cd5\u548c ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor#postProcessBeanFactory"})," \u65b9\u6cd5"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/image-20220201173753538.png",alt:"image-20220201173753538"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"\u6267\u884cBeanFactoryPostProcessor\u6267\u884c\uff1a"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor#postProcessBeanFactory"})," \u5b9e\u73b0\u4e86 ",(0,n.jsx)(r.strong,{children:"PriorityOrdered"})," \u63a5\u53e3\u7684"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"sortPostProcessors(priorityOrderedPostProcessors, beanFactory);\ninvokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor#postProcessBeanFactory"})," \u5b9e\u73b0\u4e86 ",(0,n.jsx)(r.strong,{children:"Ordered"})," \u63a5\u53e3\u7684"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"List<BeanFactoryPostProcessor> orderedPostProcessors = new ArrayList<>(orderedPostProcessorNames.size());\nfor (String postProcessorName : orderedPostProcessorNames) {\n\torderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));\n}\nsortPostProcessors(orderedPostProcessors, beanFactory);\ninvokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);\n"})}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsxs)(r.p,{children:["\u6267\u884c\u5269\u4e0b\u7684 ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor#postProcessBeanFactory"})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"List<BeanFactoryPostProcessor> nonOrderedPostProcessors = new ArrayList<>(nonOrderedPostProcessorNames.size());\nfor (String postProcessorName : nonOrderedPostProcessorNames) {\n\tnonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));\n}\ninvokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);\n"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["\u901a\u8fc7\u4e0a\u9762\u7684\u4ee3\u7801\u5206\u6790\u603b\u7ed3\u4e00\u4e0b ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"})})," \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanDefinitionRegistryPostProcessor"})}),"  \u6267\u884c\u987a\u5e8f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:"https://raw.githubusercontent.com/mxsm/picture/main/spring/BeanFactoryPostProcessor%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE.png",alt:"BeanFactoryPostProcessor\u6267\u884c\u6d41\u7a0b\u56fe"})}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\u9996\u5148\u5e94\u8be5\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessor#postProcessBeanDefinitionRegistry"})," \u65b9\u6cd5"]}),"\n",(0,n.jsxs)(r.li,{children:["\u7136\u540e\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanDefinitionRegistryPostProcessor#postProcessBeanFactory"})," \u65b9\u6cd5"]}),"\n",(0,n.jsxs)(r.li,{children:["\u6700\u540e\u6267\u884c ",(0,n.jsx)(r.strong,{children:"BeanFactoryPostProcessor#postProcessBeanFactory"})," \u65b9\u6cd5"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"Tips: BeanDefinitionRegistryPostProcessor\u548cBeanFactoryPostProcessor\u7684\u6267\u884c\u8fd8\u548cPriorityOrdered\u4ee5\u53caOrdered\u6709\u5173\u3002"}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"3-\u603b\u7ed3",children:"3. \u603b\u7ed3"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanFactoryPostProcessor"})})," \u548c ",(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"BeanDefinitionRegistryPostProcessor"})})," \u53ef\u901a\u8fc7Spring\u539f\u751f\u7684\u5b9e\u73b0\u6765\u505a\u4e00\u4e9b\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u62d3\u5c55\uff0c\u4f8b\u5982 ",(0,n.jsx)(r.strong,{children:"ConfigurationClassPostProcessor"})," \u53ef\u4ee5\u53d7\u5230\u542f\u53d1\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e9b\u914d\u7f6e\u5728\u7c7b\u4e0a\u9762\u7684\u6ce8\u89e3\uff0c\u4f8b\u5982\u81ea\u5b9a\u4e49\u548c@Component\u7c7b\u4f3c\u7684\u6ce8\u89e3\u3002"]})]})}function g(s={}){const{wrapper:r}={...(0,o.R)(),...s.components};return r?(0,n.jsx)(r,{...s,children:(0,n.jsx)(l,{...s})}):l(s)}},8453:(s,r,e)=>{e.d(r,{R:()=>t,x:()=>c});var n=e(6540);const o={},i=n.createContext(o);function t(s){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof s?s(r):{...r,...s}}),[r,s])}function c(s){let r;return r=s.disableParentContext?"function"==typeof s.components?s.components(o):s.components||o:t(s.components),n.createElement(i.Provider,{value:r},s.children)}}}]);