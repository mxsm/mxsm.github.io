<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Netty-ChannelHandler组件 | 蚂蚁背大象</title><meta property="og:title" content="Netty-ChannelHandler组件"><meta property="og:description" content="Channel的生命周期    状态 描述     ChannelUnregistered Channel 已经被创建，但还未注册到 EventLoop   ChannelRegistered Channel 已经被注册到了 EventLoop   ChannelActive Channel 处于活动状态(已经连接到它的远程节点)。它现在可以接收和发送数据了   ChannelInactive Channel没有连接到远程节点    当这些状态发生改变的时候，将会生成对应的事件。这些事件会被转发给 ChannelPipeline 中的 ChannelHandler 其可以随后对他们做出响应。
ChannelHandler的生命周期    类型 描述     handlerAdded 当把 ChannelHandler 添加到 ChannelPipeline 中时被调用   handlerRemoved 当从 ChannelPipeline 中移除 ChannelHandler 时被调用   exceptionCaught 当处理过程中在 ChannelPipeline 中有错误产生时被调用    Netty 定义了下面两个重要的 ChannelHandler 子接口："><meta property="og:type" content="article"><meta property="og:url" content="/middlewares/netty/netty-channelhandler/"><meta property="article:section" content="middlewares"><meta property="article:published_time" content="2018-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-06T21:26:34+08:00"><meta property="og:site_name" content="蚂蚁背大象"><meta itemprop=name content="Netty-ChannelHandler组件"><meta itemprop=description content="Channel的生命周期    状态 描述     ChannelUnregistered Channel 已经被创建，但还未注册到 EventLoop   ChannelRegistered Channel 已经被注册到了 EventLoop   ChannelActive Channel 处于活动状态(已经连接到它的远程节点)。它现在可以接收和发送数据了   ChannelInactive Channel没有连接到远程节点    当这些状态发生改变的时候，将会生成对应的事件。这些事件会被转发给 ChannelPipeline 中的 ChannelHandler 其可以随后对他们做出响应。
ChannelHandler的生命周期    类型 描述     handlerAdded 当把 ChannelHandler 添加到 ChannelPipeline 中时被调用   handlerRemoved 当从 ChannelPipeline 中移除 ChannelHandler 时被调用   exceptionCaught 当处理过程中在 ChannelPipeline 中有错误产生时被调用    Netty 定义了下面两个重要的 ChannelHandler 子接口："><meta itemprop=datePublished content="2018-09-15T00:00:00+00:00"><meta itemprop=dateModified content="2021-05-06T21:26:34+08:00"><meta itemprop=wordCount content="531"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Netty-ChannelHandler组件"><meta name=twitter:description content="Channel的生命周期    状态 描述     ChannelUnregistered Channel 已经被创建，但还未注册到 EventLoop   ChannelRegistered Channel 已经被注册到了 EventLoop   ChannelActive Channel 处于活动状态(已经连接到它的远程节点)。它现在可以接收和发送数据了   ChannelInactive Channel没有连接到远程节点    当这些状态发生改变的时候，将会生成对应的事件。这些事件会被转发给 ChannelPipeline 中的 ChannelHandler 其可以随后对他们做出响应。
ChannelHandler的生命周期    类型 描述     handlerAdded 当把 ChannelHandler 添加到 ChannelPipeline 中时被调用   handlerRemoved 当从 ChannelPipeline 中移除 ChannelHandler 时被调用   exceptionCaught 当处理过程中在 ChannelPipeline 中有错误产生时被调用    Netty 定义了下面两个重要的 ChannelHandler 子接口："><link rel=preload href=/scss/main.min.e09cb23c7dff3bf1285aa0294bcdc4ac8194fb3425a99c621e31e7b871315685.css as=style><link href=/scss/main.min.e09cb23c7dff3bf1285aa0294bcdc4ac8194fb3425a99c621e31e7b871315685.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">蚂蚁背大象</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>Home</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Java</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/spring/><span>Spring</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/middlewares/><span class=active>Middleware</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/other/><span>Others</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Middleware</a></li><ul><li class="collapse show" id=middlewares><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Apache RocketMQ</a></li><ul><li class=collapse id=middlewaresrocketmq><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/practice/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Apache RocketMQ 应用</a></li><ul><li class=collapse id=middlewaresrocketmqpractice><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqpracticerocketmq-slf4j-logging href=/middlewares/rocketmq/practice/rocketmq-slf4j-logging/>当SLF4J遇上RocketMQ</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-base-concept href=/middlewares/rocketmq/rocketmq-base-concept/>RocketMQ-基本概念</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-architecture-design href=/middlewares/rocketmq/rocketmq-architecture-design/>RocketMQ-架构设计</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-module-design href=/middlewares/rocketmq/rocketmq-module-design/>RocketMQ-模块设计</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-character href=/middlewares/rocketmq/rocketmq-character/>RocketMQ-特性</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/name-server/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ Name Server</a></li><ul><li class=collapse id=middlewaresrocketmqname-server><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqname-servernameserver href=/middlewares/rocketmq/name-server/nameserver/>NameServer</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqname-serverrocketmq-analysis-nameserver-start href=/middlewares/rocketmq/name-server/rocketmq-analysis-nameserver-start/>RocketMQ源码解析-NameServer启动</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqname-serverrocketmq-analysis-broker-manage href=/middlewares/rocketmq/name-server/rocketmq-analysis-broker-manage/>RocketMQ源码解析-NameServer对Broker的管理</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/broker/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ Broker</a></li><ul><li class=collapse id=middlewaresrocketmqbroker><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-start href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-start/>RocketMQ源码解析-Broker启动</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-nameserver-interaction href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-nameserver-interaction/>RocketMQ源码解析-Broker与NameServer交互</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-message-store href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-message-store/>RocketMQ源码解析-Broker消息存储设计与实现</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-commitlog href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-commitlog/>RocketMQ源码解析-Broker消息存储CommitLog</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-consumequeue href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-consumequeue/>RocketMQ源码解析-Broker消息存储ConsumeQueue</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-recevie-pull href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-recevie-pull/>RocketMQ源码解析-Broker接收拉取消息</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-failure-recovery href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-failure-recovery/>RocketMQ源码解析-Broker故障恢复</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-configfile href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-configfile/>RocketMQ源码解析-Broker存储配置文件说明</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-tag-filter href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-tag-filter/>RocketMQ源码解析-Broker 消息Tag过滤</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/producer/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RockerMQ 生产者</a></li><ul><li class=collapse id=middlewaresrocketmqproducer><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerrocketmq-analysis-topic-create-strategy href=/middlewares/rocketmq/producer/rocketmq-analysis-topic-create-strategy/>RocketMQ源码解析-topic创建机制</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerrocketmq-analysis-producer-msgsend-strategy href=/middlewares/rocketmq/producer/rocketmq-analysis-producer-msgsend-strategy/>RocketMQ源码解析-生产者投递消息策略</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerrocketmq-analysis-producer-messagesend href=/middlewares/rocketmq/producer/rocketmq-analysis-producer-messagesend/>RocketMQ源码解析-producer发送消息的流程</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerproducer href=/middlewares/rocketmq/producer/producer/>Producer</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/consumer/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ 消费者</a></li><ul><li class=collapse id=middlewaresrocketmqconsumer><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer/>RocketMQ源码解析-消费者启动源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-scheduledtask href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-scheduledtask/>RocketMQ源码解析-消费者定时任务解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-messagemodel href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-messagemodel/>RocketMQ源码解析-消费模式消费进度加载源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-concurrently href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-concurrently/>RocketMQ源码解析-并发消费消息源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-strategy href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-strategy/>RocketMQ源码解析-消费者消费策略源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-ack href=/middlewares/rocketmq/consumer/rocketmq-analysis-ack/>RocketMQ源码解析-RocketMQ消息ACK机制及消费进度管理</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-ordermessage-consume href=/middlewares/rocketmq/consumer/rocketmq-analysis-ordermessage-consume/>RocketMQ源码解析-RocketMQ顺序消息的投递与消费</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-repeat-consume href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-repeat-consume/>RocketMQ源码解析-消费者重复消费</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/issue/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ Issue</a></li><ul><li class=collapse id=middlewaresrocketmqissue><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqissuebroker-busy-issue href=/middlewares/rocketmq/issue/broker-busy-issue/>broker busy问题</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-docker href=/middlewares/rocketmq/rocketmq-docker/>RocketMQ Docker部署</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq5/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Apache RocketMQ5</a></li><ul><li class=collapse id=middlewaresrocketmq5><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq5/quick-start/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ5.0 Quick start</a></li><ul><li class=collapse id=middlewaresrocketmq5quick-start><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5quick-startdledger-controller href=/middlewares/rocketmq5/quick-start/dledger-controller/>RocketMQ5.0 Controller DLedger模式</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq5/store/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ5 Store</a></li><ul><li class=collapse id=middlewaresrocketmq5store><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5storecommitlog href=/middlewares/rocketmq5/store/commitlog/>RocketMQ55.0-CommitLog设计与源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5storeautoswitchhaclient-source-code-analysis href=/middlewares/rocketmq5/store/autoswitchhaclient-source-code-analysis/>RocketMQ5.0源码分析-AutoSwitchHAClient</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5storecommitlog-important-attribute href=/middlewares/rocketmq5/store/commitlog-important-attribute/>RocketMQ5.0源码解析-CommitLog设计与几个重要的属性关系图文解析</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5habroker-elect-master href=/middlewares/rocketmq5/ha/broker-elect-master/>RocketMQ5.0主备自动切换模式Broker选主详解</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/netty/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Netty</a></li><ul><li class="collapse show" id=middlewaresnetty><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-annotation-sharable href=/middlewares/netty/netty-annotation-sharable/>Netty @Sharable到底是干什么用的</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/netty/netty-source-code-analysis/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Netty源码解析</a></li><ul><li class=collapse id=middlewaresnettynetty-source-code-analysis><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-analysis-sizeclasses href=/middlewares/netty/netty-source-code-analysis/netty-source-analysis-sizeclasses/>Netty源码解析-sizeClasses</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-analysis-pooled-manage href=/middlewares/netty/netty-source-code-analysis/netty-source-analysis-pooled-manage/>Netty源码解析-池化内存管理解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-fastthreadlocal href=/middlewares/netty/netty-source-code-analysis/netty-fastthreadlocal/>Netty FastThreadLocal相比Java ThreadLocal到底快在哪里?</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-eventloopgroup-howto-work href=/middlewares/netty/netty-source-code-analysis/netty-eventloopgroup-howto-work/>Netty源码分析-EventLoopGroup如何工作</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-eventloop-base href=/middlewares/netty/netty-source-code-analysis/netty-eventloop-base/>Netty组件-EventLoop</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-components-channelhandler href=/middlewares/netty/netty-source-code-analysis/netty-components-channelhandler/>Netty组件-ChannelHandler</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-channelhandler-order href=/middlewares/netty/netty-source-code-analysis/netty-source-channelhandler-order/>Netty源码分析-ChannelHandler方法执行顺序和如何工作</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-decoder href=/middlewares/netty/netty-source-code-analysis/netty-source-decoder/>Netty源码解析-解码器(Decoder)是如何工作</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-cumulator href=/middlewares/netty/netty-source-code-analysis/netty-source-cumulator/>Netty源码解析-累加器(Cumulator)处理粘包半包问题</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-components-channelpipeline-channelcontext href=/middlewares/netty/netty-source-code-analysis/netty-components-channelpipeline-channelcontext/>Netty组件-ChannelHandlerContext和ChannelPipeline</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-channelread-object href=/middlewares/netty/netty-source-code-analysis/netty-source-channelread-object/>Netty源码解析-ChannelInboundHandler#channelRead参数Object对象到底是什么类型</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-serverbootstrap-flow href=/middlewares/netty/netty-source-code-analysis/netty-source-serverbootstrap-flow/>Netty源码解析-服务端启动流程详解</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-eventloop-startrun href=/middlewares/netty/netty-source-code-analysis/netty-source-eventloop-startrun/>Netty源码解析-EventLoop什么时候启动运行</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-bossgroup-switch-workgroup href=/middlewares/netty/netty-source-code-analysis/netty-source-bossgroup-switch-workgroup/>Netty源码分析-Channel如何从主线程切换到从线程</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-bytebuf href=/middlewares/netty/netty-bytebuf/>Netty四大组件之ByteBuf</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-channel href=/middlewares/netty/netty-channel/>Netty五大组件之Channel</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/netty/netty-faq/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Netty答疑解惑</a></li><ul><li class=collapse id=middlewaresnettynetty-faq><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-faqnetty-faq-eventloopgroup-executor href=/middlewares/netty/netty-faq/netty-faq-eventloopgroup-executor/>Netty答疑解惑-EventLoopGroup执行器线程数小于nThreads会怎么样?</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-faqnetty-faq-components-relation href=/middlewares/netty/netty-faq/netty-faq-components-relation/>Netty答疑解惑-Netty组件之间的关系</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-eventloop href=/middlewares/netty/netty-eventloop/>Netty-EventLoop</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty href=/middlewares/netty/netty/>Netty</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-middlewaresnettynetty-channelhandler href=/middlewares/netty/netty-channelhandler/>Netty-ChannelHandler组件</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-optimize href=/middlewares/netty/netty-optimize/>Netty优化</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/redis/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Redis</a></li><ul><li class=collapse id=middlewaresredis><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-data-struct href=/middlewares/redis/redis-data-struct/>Redis底层-数据结构</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-persistence href=/middlewares/redis/redis-persistence/>Redis持久化</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-cluster href=/middlewares/redis/redis-cluster/>Redis集群</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-cluster-strategy href=/middlewares/redis/redis-cluster-strategy/>Redis三种集群策略</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-data-elimination-strategy href=/middlewares/redis/redis-data-elimination-strategy/>Redis数据淘汰策略</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/kafka/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Kafka</a></li><ul><li class=collapse id=middlewareskafka><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewareskafkakafka-base href=/middlewares/kafka/kafka-base/>kafka基本知识</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/etcd/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ETCD</a></li><ul><li class=collapse id=middlewaresetcd><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresetcdetcd href=/middlewares/etcd/etcd/>ETCD</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/docker/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Docker</a></li><ul><li class=collapse id=middlewaresdocker><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/docker/docker-base/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Docker基础知识</a></li><ul><li class=collapse id=middlewaresdockerdocker-base><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedocker-install href=/middlewares/docker/docker-base/docker-install/>Centos8 Docker安装</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedocker-command href=/middlewares/docker/docker-base/docker-command/>Docker常见的命令</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedockerfile href=/middlewares/docker/docker-base/dockerfile/>Dockfile</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedocker-compose-file href=/middlewares/docker/docker-base/docker-compose-file/>Docker Compose file</a></li></ul></ul></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/mxsm/mxsm-website/edit/main/content/en/middlewares/netty/Netty-ChannelHandler.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/mxsm/mxsm-website/new/main/content/en/middlewares/netty/Netty-ChannelHandler.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/mxsm/mxsm-website/issues/new?title=Netty-ChannelHandler%e7%bb%84%e4%bb%b6" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/mxsm/mxsm-website/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a>
<a id=print href=/middlewares/netty/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#channel的生命周期>Channel的生命周期</a></li><li><a href=#channelhandler的生命周期>ChannelHandler的生命周期</a><ul><li><a href=#channelinboundhandler-接口>ChannelInboundHandler 接口</a></li><li><a href=#channeloutboundhandler-接口>ChannelOutboundHandler 接口</a></li><li><a href=#channelhandler的适配器>ChannelHandler的适配器</a></li><li><a href=#资源管理>资源管理</a></li></ul></li><li><a href=#channelpipeline-接口>ChannelPipeline 接口</a><ul><li><a href=#修改channelpipeline>修改ChannelPipeline</a></li><li><a href=#事件触发>事件触发</a></li></ul></li><li><a href=#channelhandlercontext-接口>ChannelHandlerContext 接口</a></li><li><a href=#总结>总结：</a></li></ul></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/middlewares/>Middleware</a></li><li class=breadcrumb-item><a href=/middlewares/netty/>Netty</a></li><li class="breadcrumb-item active" aria-current=page><a href=/middlewares/netty/netty-channelhandler/>Netty-ChannelHandler组件</a></li></ol></nav><div class=td-content><h1>Netty-ChannelHandler组件</h1><div class="td-byline mb-4"><time datetime=2018-09-15 class=text-muted>2018-09-15</time></div><h3 id=channel的生命周期>Channel的生命周期</h3><table><thead><tr><th>状态</th><th>描述</th></tr></thead><tbody><tr><td>ChannelUnregistered</td><td>Channel 已经被创建，但还未注册到 EventLoop</td></tr><tr><td>ChannelRegistered</td><td>Channel 已经被注册到了 EventLoop</td></tr><tr><td>ChannelActive</td><td>Channel 处于活动状态(已经连接到它的远程节点)。它现在可以接收和发送数据了</td></tr><tr><td>ChannelInactive</td><td>Channel没有连接到远程节点</td></tr></tbody></table><p>当这些状态发生改变的时候，将会生成对应的事件。这些事件会被转发给 <strong><code>ChannelPipeline</code></strong> 中的 <strong><code>ChannelHandler</code></strong> 其可以随后对他们做出响应。</p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/channel%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%8F%98%E5%8C%96.jpg?raw=true" alt=图解></p><h3 id=channelhandler的生命周期>ChannelHandler的生命周期</h3><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>handlerAdded</td><td>当把 ChannelHandler 添加到 ChannelPipeline 中时被调用</td></tr><tr><td>handlerRemoved</td><td>当从 ChannelPipeline 中移除 ChannelHandler 时被调用</td></tr><tr><td>exceptionCaught</td><td>当处理过程中在 ChannelPipeline 中有错误产生时被调用</td></tr></tbody></table><p><strong><code>Netty</code></strong> 定义了下面两个重要的 <strong><code>ChannelHandler</code></strong> 子接口：</p><ul><li><strong>ChannelInboundHandler</strong> — 处理 <strong>入站</strong> 数据以及各种状态变化</li><li><strong>ChannelOutboundHandler</strong> — 处理 <strong>出站</strong> 数据并且允许拦截所有的操作</li></ul><h4 id=channelinboundhandler-接口>ChannelInboundHandler 接口</h4><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>channelRegistered</td><td>当 Channel 已经注册到它的 EventLoop 并且能够处理 I/O 时被调用</td></tr><tr><td>channelUnregistered</td><td>当 Channel 从它的 EventLoop 注销并且无法处理任何 I/O 时被调用</td></tr><tr><td>channelActive</td><td>当 Channel 处于活动状态时被调用;Channel 已经连接/绑定并且已经就绪</td></tr><tr><td>channelInactive</td><td>当 Channel 离开活动状态并且不再连接它的远程节点时被调用</td></tr><tr><td>channelReadComplete</td><td>当Channel上的一个读操作完成时被调用</td></tr><tr><td>channelRead</td><td>当从 Channel 读取数据时被调用</td></tr><tr><td>ChannelWritabilityChanged</td><td>当Channel的可写状态发生改变时被调用。用户可以确保写操作不会完成得太快(以避免发生 OutOfMemoryError)或者可以在 Channel 变为再次可写时恢复写入。可以通过调用Channel的isWritable()方法来检测Channel 的可写性。与可写性相关的阈值可以通过Channel.config().setWriteHighWaterMark()和 Channel.config().setWriteLowWaterMark()方法来设置</td></tr><tr><td>userEventTriggered</td><td>当 ChannelnboundHandler.fireUserEventTriggered()方法被调用时被调用，因为一个 POJO 被传经了 ChannelPipeline</td></tr></tbody></table><h4 id=channeloutboundhandler-接口>ChannelOutboundHandler 接口</h4><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>bind(ChannelHandlerContext,SocketAddress,ChannelPromise)</td><td>当请求将 Channel 绑定到本地地址时被调用</td></tr><tr><td>connect(ChannelHandlerContext,SocketAddress,SocketAddress,ChannelPromise)</td><td>当请求将 Channel 连接到远程节点时被调用</td></tr><tr><td>disconnect(ChannelHandlerContext,ChannelPromise)</td><td>当请求将 Channel 从远程节点断开时被调用</td></tr><tr><td>close(ChannelHandlerContext,ChannelPromise)</td><td>当请求关闭 Channel 时被调用</td></tr><tr><td>deregister(ChannelHandlerContext,ChannelPromise)</td><td>当请求将 Channel 从它的 EventLoop 注销时被调用</td></tr><tr><td>read(ChannelHandlerContext)</td><td>当请求从 Channel 读取更多的数据时被调用</td></tr><tr><td>flush(ChannelHandlerContext)</td><td>当请求通过 Channel 将入队数据冲刷到远程节点时被调用</td></tr><tr><td>write(ChannelHandlerContext,Object,ChannelPromise)</td><td>当请求通过 Channel 将数据写到远程节点时被调用</td></tr></tbody></table><h4 id=channelhandler的适配器>ChannelHandler的适配器</h4><p><img src="https://github.com/mxsm/document/blob/master/image/netty/ChannelHandlerAdapter.jpg?raw=true" alt=图解></p><h4 id=资源管理>资源管理</h4><p><strong>泄露级别的检测：</strong></p><table><thead><tr><th>级别</th><th>描述</th></tr></thead><tbody><tr><td>DISABLED</td><td>禁用泄漏检测。只有在详尽的测试之后才应设置为这个值</td></tr><tr><td>SIMPLE</td><td>使用 1%的默认采样率检测并报告任何发现的泄露。这是默认级别，适合绝大部分的情况</td></tr><tr><td>ADVANCED</td><td>使用默认的采样率，报告所发现的任何的泄露以及对应的消息被访问的位置</td></tr><tr><td>PARANOID</td><td>类似于ADVANCED，但是其将会对每次(对消息的)访问都进行采样。这对性能将会有很大的影响，应该只在调试阶段使用</td></tr></tbody></table><p>属性表中的值可以通过： <strong><code>java -Dio.netty.leakDetectionLevel=ADVANCED</code></strong> 来进行设置。</p><h3 id=channelpipeline-接口>ChannelPipeline 接口</h3><p><strong><code>ChannelPipeline</code></strong> 是一个拦截流经 <strong><code>Channel</code></strong> 的入站和出站事件的 <strong>ChannelHandler</strong> 实例链。下图为 <strong><code>Netty-4.1.17</code></strong> 中给出来的示意图：</p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/ChannelPipelineJDK%E4%B8%AD%E7%A4%BA%E6%84%8F%E5%9B%BE.jpg?raw=true" alt=图解></p><p>每一个新创建的 <strong><code>Channel</code></strong> 都将会被分配一个新的 <strong><code>ChannelPipeline</code></strong> 。这项关联是永久性的在整个生命周期当中。 <strong><code>Channel</code></strong> 既不能附加另外一个 <strong><code>ChannelPipeline</code></strong> ，也不能分离其当前的。在 <strong><code>Netty</code></strong> 组件的生命周期中，这一项固定的操作，不需要开发人员的任何干预。</p><p>根据事件的起源( <strong>出站还是入站</strong> ) 事件将会被 <strong><code>ChannelInboundHandler</code></strong> 或 <strong><code>ChannelOutboundHandler</code></strong> 处理。随后通过调用 <strong><code>ChannelHandlerContext</code></strong> 实现，它将被转发给同一超类型的下一个 <strong><code>ChannelHandler</code></strong> 。下图展示了事件如何在 <strong><code>ChannelPipeline</code></strong> 中传播</p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/ChannelPipeline.jpg?raw=true" alt=图解></p><p>在 <strong><code>ChannelPipeline</code></strong> 传播事件的时候，他会测试 <strong><code>ChannelPipeline</code></strong> 的下一个 <strong><code>ChannelHandler</code></strong> 的类型是否和事件的运动方向相匹配。如果不匹配， <strong><code>ChannelPipeline</code></strong> 将跳过该 <strong><code>ChannelHandler</code></strong> 前进到下一个，直到找到和该事件所期望的方向相匹配的为止。 注意： <strong>ChannelHandler 也可以同时实现 ChannelInboundHandler 接口和 ChannelOutboundHandler 接口</strong></p><h4 id=修改channelpipeline>修改ChannelPipeline</h4><p><strong><code>ChannelHandler</code></strong> 可以通过添加、删除或者替换其他的 <strong><code>ChannelHandler</code></strong> 来实时地修改 <strong><code>ChannelPipeline</code></strong> 布局，这就是 <strong><code>ChannelHandler</code></strong> 最重要的能力之一。</p><table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>addFrist,addBefore,addAfter,addLast</td><td>将一个ChannelHandler添加到ChannelPipeline中</td></tr><tr><td>remove</td><td>将一个 ChannelHandler 从 ChannelPipeline 中移除</td></tr><tr><td>replace</td><td>将 ChannelPipeline 中的一个 ChannelHandler 替换为另一个 ChannelHandler</td></tr></tbody></table><p>添加处理器：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000>channel</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>pipeline</span><span style=color:#ce5c00;font-weight:700>().</span>
<span style=color:#000>addLast</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;frameDecoder&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ImMessageFrameDecoder</span><span style=color:#ce5c00;font-weight:700>()).</span>
<span style=color:#000>addLast</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;protoDecoder&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ProtobufDecoder</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ImMessageProto</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>ImMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefaultInstance</span><span style=color:#ce5c00;font-weight:700>())).</span>
<span style=color:#000>addLast</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;frameEncoder&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ProtobufVarint32LengthFieldPrepender</span><span style=color:#ce5c00;font-weight:700>()).</span>
<span style=color:#000>addLast</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;protoEncoder&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ProtobufEncoder</span><span style=color:#ce5c00;font-weight:700>()).</span>
<span style=color:#000>addLast</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;imHandler&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ImHandler</span><span style=color:#ce5c00;font-weight:700>());</span>
</code></pre></div><p>删除处理器：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java> <span style=color:#000>ChannelHandler</span> <span style=color:#000>protoEncoder</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>channel</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>pipeline</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;protoEncoder&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
 <span style=color:#000>ChannelHandler</span> <span style=color:#000>frameEncoder</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>channel</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>pipeline</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;frameEncoder&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</code></pre></div><h4 id=事件触发>事件触发</h4><p><strong><code>ChannelPipeline</code></strong> 的 <strong>API</strong> 公开了用于调用入站和出站操作的附加方法。</p><p><strong>入站操作的方法：</strong></p><pre><code>方法：fireChannelRegistered
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的channelRegistered(ChannelHandlerContext)方法
</code></pre><pre><code>方法：fireChannelUnregistered
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的 channelUnregistered(ChannelHandlerContext)方法
</code></pre><pre><code>方法：fireChannelActive
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的 channelActive(ChannelHandlerContext)方法
</code></pre><pre><code>方法：fireChannelInactive
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的channelInactive(ChannelHandlerContext)方法
</code></pre><pre><code>方法：fireExceptionCaught
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的exceptionCaught(ChannelHandlerContext, Throwable)方法
</code></pre><pre><code>方法：fireUserEventTriggered
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的userEventTriggered(ChannelHandlerContext, Object)方法
</code></pre><pre><code>方法：fireChannelRead
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的channelRead(ChannelHandlerContext, Object msg)方法
</code></pre><pre><code>方法：fireChannelReadComplete
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的channelReadComplete(ChannelHandlerContext)方法
</code></pre><pre><code>方法：firechannelWritabilityChanged
作用：调用 ChannelPipeline 中下一个 ChannelInboundHandler 的  channelWritabilityChanged(ChannelHandlerContext)方法
</code></pre><p>在出站操作这边，处理事件会将导致底层的套接字上发生一系列的动作，</p><p><strong>出站操作：</strong></p><pre><code>方法：bind
作用：将 Channel 绑定到一个本地地址，这将调用 ChannelPipeline 中的下一个ChannelOutboundHandler 的 bind(ChannelHandlerContext, SocketAddress, ChannelPromise)方法
</code></pre><pre><code>方法：connect
作用：将 Channel 连接到一个远程地址，这将调用 ChannelPipeline 中的下一个ChannelOutboundHandler 的 connect(ChannelHandlerContext, SocketAddress, ChannelPromise)方法
</code></pre><pre><code>方法：disconnect
作用：将 Channel 断开连接。这将调用 ChannelPipeline 中的下一个 ChannelOutboundHandler 的 disconnect(ChannelHandlerContext, Channel Promise)方法
</code></pre><pre><code>方法：close
作用：将 Channel 关闭。这将调用 ChannelPipeline 中的下一个 ChannelOutboundHandler 的 close(ChannelHandlerContext, ChannelPromise)方法
</code></pre><pre><code>方法：deregister
作用：将 Channel 从它先前所分配的 EventExecutor(即 EventLoop)中注销。这将调用 ChannelPipeline 中的下一个 ChannelOutboundHandler 的 deregister(ChannelHandlerContext, ChannelPromise)方法
</code></pre><pre><code>方法：flush
作用：冲刷 Channel 所有挂起的写入。这将调用 ChannelPipeline 中的下一个 ChannelOutboundHandler 的 flush(ChannelHandlerContext)方法
</code></pre><pre><code>方法：write
作用：将消息写入 Channel。这将调用 ChannelPipeline 中的下一个 ChannelOutboundHandler 的 write(ChannelHandlerContext, Object msg, ChannelPromise)方法。注意:这并不会将消息写入底层的 Socket，而只会将它放入队列中。要将它写入 Socket，需要调用 flush()或者 writeAndFlush()方法
</code></pre><pre><code>方法： writeAndFlush
作用： 这是一个先调用write()方法再接着调用flush()方法的便利方法
</code></pre><pre><code>方法：read
作用：请求从 Channel 中读取更多的数据。这将调用 ChannelPipeline 中的下一个ChannelOutboundHandler 的 read(ChannelHandlerContext)方法
</code></pre><p><strong>总结：</strong></p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/ChannelPipeline%E7%BB%A7%E6%89%BF%E5%9B%BE-netty4-1.17.jpg?raw=true" alt=图解></p><ul><li><strong>Channel创建的时候同时会创建ChannelPipeline并且进行绑定</strong></li><li><strong>ChannelPipeline 保存了与 Channel 相关联的 ChannelHandler;</strong></li><li><strong>ChannelPipeline 可以根据需要，通过添加或者删除 ChannelHandler 来动态地修改</strong></li><li><strong>ChannelPipeline 有着丰富的 API 用以被调用，以响应入站和出站事件。</strong></li></ul><h3 id=channelhandlercontext-接口>ChannelHandlerContext 接口</h3><p><strong><code>ChannelHandlerContext</code></strong> 代表了 <strong><code>ChannelHandler</code></strong> 和 <strong><code>ChannelPipeline</code></strong> 之间的关联，每当有 <strong><code>ChannelHandler</code></strong> 添加到 <strong><code>ChannelPipeline</code></strong> 中时，都会创建 <strong><code>ChannelHandlerContext</code></strong> 。<strong><code>ChannelHandlerContext</code></strong> 的主要功能是管理它所关联的 <strong><code>ChannelHandler</code></strong> 和在同一个 <strong><code>ChannelPipeline</code></strong> 中的其他 <strong><code>ChannelHandler</code></strong> 之间的交互。(<strong>只要有ChannelHandler的添加就会创建ChannelHandlerContext</strong>)</p><p><strong><code>ChannelHandlerContext</code></strong> 和 <strong><code>Channel</code></strong> 以及 <strong><code>ChannelPipeline</code></strong> 有一些相同的方法。这些方法区别在哪。</p><ul><li>如果调用 <strong><code>Channel</code></strong> 或者 <strong><code>ChannelPipeline</code></strong> 上的这些方法，它们将沿着整个 <strong><code>ChannelPipeline</code></strong> 进行传播。而调用位于 <strong><code>ChannelHandlerContext</code></strong> 上的相同方法，则将从当前所关联的 <strong><code>ChannelHandler</code></strong> 开始，并且只会传播给位于该 <strong><code>ChannelPipeline</code></strong> 中的下一个能够处理该事件的 <strong><code>ChannelHandler</code></strong> 。(<strong>事件传播的范围不一样</strong>)</li></ul><p>使用 <strong><code>ChannelHandlerContext</code></strong> 的 <strong>API</strong> 的时候牢记以下两点：</p><ul><li><strong><code>ChannelHandlerContext</code></strong> 和 <strong><code>ChannelHandler</code></strong> 之间的关联(绑定)是永远不会改变的，所以缓存对它的引用是安全的。</li><li>相对于其他类的同名方法，<strong><code>ChannelHandlerContext</code></strong> 的方法将产生更短的事件流，应该尽可能地利用这个特性来获得最大的性能。</li></ul><p>下面看一下 <strong><code>ChannelHandlerContext</code></strong> 、 <strong><code>Channel</code></strong> 和 <strong><code>ChannelPipeline</code></strong> 的关系图：</p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/context-Channel-pipeline%E4%B8%89%E8%80%85%E5%85%B3%E7%B3%BB%E5%9B%BE.jpg?raw=true" alt=图片></p><p>下面看一下调用Channel 和 ChannelPipeline的方法导致写入事件从尾端到头部地流经 ChannelPipeline示意图：</p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/Channel-ChannelPipeline%E4%BA%8B%E4%BB%B6%E4%BC%A0%E6%92%AD%E5%9B%BE.jpg?raw=true" alt=图解></p><p><strong>注意：重要的是要注意到，虽然被调用的 Channel 或 ChannelPipeline 上的 write()方法将一直传播事件通</strong>
<strong>过整个 ChannelPipeline，但是在 ChannelHandler 的级别上，事件从一个 ChannelHandler到下一个 ChannelHandler 的移动是由 ChannelHandlerContext 上的调用完成的。</strong></p><p>下面看一下 <strong><code>ChannelHandlerContext</code></strong> 事件被传播示意图：</p><p><img src="https://github.com/mxsm/document/blob/master/image/netty/ChannelHandlerContext%E8%A7%A6%E5%8F%91%E7%9A%84%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B%E4%BA%8B%E4%BB%B6%E4%BC%A0%E6%92%AD.jpg?raw=true" alt=图解></p><h3 id=总结>总结：</h3><ul><li><strong>Channel的生命周期以及ChannelPipeline的生命周期— 这两个生命周期是同生死</strong></li><li><strong>Channel ChannelPipeline 以及 ChannelHandlerContext 事件传播范围</strong></li><li><strong>Channel ChannelPipeline 以及 ChannelHandlerContext 三者之间的关系</strong></li></ul><br><div class=page-blank><div id=disqus_thread></div><script>(function(){var a=document,b=a.createElement('script');b.src='https://ljbmxsm.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/middlewares/netty/netty-optimize/ class="btn btn-primary"><span class=mr-1>←</span> 上一页</a></li><a href=/middlewares/netty/netty/ class="btn btn-primary">下一页 <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://groups.google.com/u/1/g/ljbmxsm><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=个人掘金主页 aria-label=个人掘金主页><a class=text-white target=_blank rel="noopener noreferrer" href=https://juejin.cn/user/1151943918492855><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/mxsm><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>隐私政策</a></small><p class=mt-2><a href=/about/>Home</a></p></div></div></div></footer><div><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><script>$("p img").wrap(function(){return'<a data-fancybox="gallery" href="'+$(this).attr('src')+'"></a>'})</script></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@8.8.1/dist/mermaid.min.js integrity=sha384-to2w0I1OqmbJ9J6yTnIX+KYU8grNpZoD1dKPLjgEJvMe5L5+/7qvuNa2sQo8WAWj crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js integrity="sha512-tBzZQxySO5q5lqwLWfu8Q+o4VkTcRGOeQGVQ0ueJga4A1RKuzmAu5HXDOXLEjpbKyV7ow9ympVoa6wZLEzRzDg==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.15.0/flowchart.min.js integrity="sha512-6QsSiIybtf8tuZ6xfjRTr2tdtw3Gp4q5RSCh2b6q9seoKEQmhAG1RrCA8F0kXTwivVxRVbp/YF3zOh8rvEAU7Q==" crossorigin=anonymous></script><script src=/js/main.min.b541b310f01941a0abfd76b652b5fb60dac470573775bb5b31ff08fe3f6cea51.js integrity="sha256-tUGzEPAZQaCr/Xa2UrX7YNrEcFc3dbtbMf8I/j9s6lE=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({appId:'JO2SY3WDAC',apiKey:'324ddb3b679c1308e5aa8bf222e07f8b',indexName:'mxsm',inputSelector:'.td-search-input',debug:!1})</script></body></html>