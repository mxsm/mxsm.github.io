<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>RocketMQ5.0主备自动切换模式Broker选主详解 | 蚂蚁背大象</title><meta property="og:title" content="RocketMQ5.0主备自动切换模式Broker选主详解"><meta property="og:description" content="RocketMQ5.0增加了主备自动切换模式，这个模式是基于新开发的模块DLedger Controller(基于Raft组件DLedger)。下面结合源码来分析一下RocketMQ主备自动切换模式下的选主的流程。
 Tips: RocketMQ源码版本：5.0.0
 1. 何时选主Broker Broker的选主发起主要有三种情况：
  通过admin命令人为主动发起重新选主
命令发起具体参照 electMaster 命令(运维命令由笔者开发完成)，详细使用参照命令的说明
  RocketMQ集群刚搭建Broker启动注册Broker到DLedger Controller，DLedger Controller还没有选主，然后触发选主操作。
  RocketMQ Broker Master下线或者因为其他情况不能正常提供服务与DLedger Controller服务不能正常连接或者心跳失效，会触发DLedger Controller选主Broker
  2. 如何选主Broker 文章上面有提到触发选主的三种情况，下面我们就把这三种情况一一进行分析
2.1 Broker启动注册触发选主 主备自主切换模式下Broker启动时候到底是Master还是Slave需要通过DLedger Controller服务通过选主的方式来确定。
Broker启动注册到DLedger Controller
Broker启动后，将Broker的元数据：
 clusterName brokerName address epoch maxOffset  注册到DLedger Controller,由 BrokerOuterAPI#registerBrokerToController 提供注册的服务：
DLedger Controller触发选主
DLedger Controller 模块的主要逻辑在ReplicasInfoManager中。当DLedger Controller接收到Broker发送的 CONTROLLER_REGISTER_BROKER 消息后就处理选主，由ReplicasInfoManager#registerBroker处理逻辑：
Broker Change Role
Broker注册后收到DLedger Controller返回的数据，根据返回数据的Master Address和Broker的IP进行对比来判断当前Broker是设置为Master还是Slave。
到这里就实现了Broker的选主。
2.2 Broker Master Inactive触发选主 Broker Master下线或者Broker Master和DLedger Controller心跳失效触发选主，DLedger Controller有一个定时任务执行 DefaultBrokerHeartbeatManager#scanNotActiveBroker ："><meta property="og:type" content="article"><meta property="og:url" content="/middlewares/rocketmq5/ha/broker-elect-master/"><meta property="article:section" content="middlewares"><meta property="article:published_time" content="2022-10-19T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-19T20:47:16+08:00"><meta property="og:site_name" content="蚂蚁背大象"><meta itemprop=name content="RocketMQ5.0主备自动切换模式Broker选主详解"><meta itemprop=description content="RocketMQ5.0增加了主备自动切换模式，这个模式是基于新开发的模块DLedger Controller(基于Raft组件DLedger)。下面结合源码来分析一下RocketMQ主备自动切换模式下的选主的流程。
 Tips: RocketMQ源码版本：5.0.0
 1. 何时选主Broker Broker的选主发起主要有三种情况：
  通过admin命令人为主动发起重新选主
命令发起具体参照 electMaster 命令(运维命令由笔者开发完成)，详细使用参照命令的说明
  RocketMQ集群刚搭建Broker启动注册Broker到DLedger Controller，DLedger Controller还没有选主，然后触发选主操作。
  RocketMQ Broker Master下线或者因为其他情况不能正常提供服务与DLedger Controller服务不能正常连接或者心跳失效，会触发DLedger Controller选主Broker
  2. 如何选主Broker 文章上面有提到触发选主的三种情况，下面我们就把这三种情况一一进行分析
2.1 Broker启动注册触发选主 主备自主切换模式下Broker启动时候到底是Master还是Slave需要通过DLedger Controller服务通过选主的方式来确定。
Broker启动注册到DLedger Controller
Broker启动后，将Broker的元数据：
 clusterName brokerName address epoch maxOffset  注册到DLedger Controller,由 BrokerOuterAPI#registerBrokerToController 提供注册的服务：
DLedger Controller触发选主
DLedger Controller 模块的主要逻辑在ReplicasInfoManager中。当DLedger Controller接收到Broker发送的 CONTROLLER_REGISTER_BROKER 消息后就处理选主，由ReplicasInfoManager#registerBroker处理逻辑：
Broker Change Role
Broker注册后收到DLedger Controller返回的数据，根据返回数据的Master Address和Broker的IP进行对比来判断当前Broker是设置为Master还是Slave。
到这里就实现了Broker的选主。
2.2 Broker Master Inactive触发选主 Broker Master下线或者Broker Master和DLedger Controller心跳失效触发选主，DLedger Controller有一个定时任务执行 DefaultBrokerHeartbeatManager#scanNotActiveBroker ："><meta itemprop=datePublished content="2022-10-19T00:00:00+00:00"><meta itemprop=dateModified content="2022-10-19T20:47:16+08:00"><meta itemprop=wordCount content="150"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="RocketMQ5.0主备自动切换模式Broker选主详解"><meta name=twitter:description content="RocketMQ5.0增加了主备自动切换模式，这个模式是基于新开发的模块DLedger Controller(基于Raft组件DLedger)。下面结合源码来分析一下RocketMQ主备自动切换模式下的选主的流程。
 Tips: RocketMQ源码版本：5.0.0
 1. 何时选主Broker Broker的选主发起主要有三种情况：
  通过admin命令人为主动发起重新选主
命令发起具体参照 electMaster 命令(运维命令由笔者开发完成)，详细使用参照命令的说明
  RocketMQ集群刚搭建Broker启动注册Broker到DLedger Controller，DLedger Controller还没有选主，然后触发选主操作。
  RocketMQ Broker Master下线或者因为其他情况不能正常提供服务与DLedger Controller服务不能正常连接或者心跳失效，会触发DLedger Controller选主Broker
  2. 如何选主Broker 文章上面有提到触发选主的三种情况，下面我们就把这三种情况一一进行分析
2.1 Broker启动注册触发选主 主备自主切换模式下Broker启动时候到底是Master还是Slave需要通过DLedger Controller服务通过选主的方式来确定。
Broker启动注册到DLedger Controller
Broker启动后，将Broker的元数据：
 clusterName brokerName address epoch maxOffset  注册到DLedger Controller,由 BrokerOuterAPI#registerBrokerToController 提供注册的服务：
DLedger Controller触发选主
DLedger Controller 模块的主要逻辑在ReplicasInfoManager中。当DLedger Controller接收到Broker发送的 CONTROLLER_REGISTER_BROKER 消息后就处理选主，由ReplicasInfoManager#registerBroker处理逻辑：
Broker Change Role
Broker注册后收到DLedger Controller返回的数据，根据返回数据的Master Address和Broker的IP进行对比来判断当前Broker是设置为Master还是Slave。
到这里就实现了Broker的选主。
2.2 Broker Master Inactive触发选主 Broker Master下线或者Broker Master和DLedger Controller心跳失效触发选主，DLedger Controller有一个定时任务执行 DefaultBrokerHeartbeatManager#scanNotActiveBroker ："><link rel=preload href=/scss/main.min.e09cb23c7dff3bf1285aa0294bcdc4ac8194fb3425a99c621e31e7b871315685.css as=style><link href=/scss/main.min.e09cb23c7dff3bf1285aa0294bcdc4ac8194fb3425a99c621e31e7b871315685.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">蚂蚁背大象</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>Home</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Java</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/spring/><span>Spring</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/middlewares/><span class=active>Middleware</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/other/><span>Others</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Middleware</a></li><ul><li class="collapse show" id=middlewares><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Apache RocketMQ</a></li><ul><li class=collapse id=middlewaresrocketmq><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/practice/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Apache RocketMQ 应用</a></li><ul><li class=collapse id=middlewaresrocketmqpractice><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqpracticerocketmq-slf4j-logging href=/middlewares/rocketmq/practice/rocketmq-slf4j-logging/>当SLF4J遇上RocketMQ</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-base-concept href=/middlewares/rocketmq/rocketmq-base-concept/>RocketMQ-基本概念</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-architecture-design href=/middlewares/rocketmq/rocketmq-architecture-design/>RocketMQ-架构设计</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-module-design href=/middlewares/rocketmq/rocketmq-module-design/>RocketMQ-模块设计</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-character href=/middlewares/rocketmq/rocketmq-character/>RocketMQ-特性</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/name-server/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ Name Server</a></li><ul><li class=collapse id=middlewaresrocketmqname-server><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqname-servernameserver href=/middlewares/rocketmq/name-server/nameserver/>NameServer</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqname-serverrocketmq-analysis-nameserver-start href=/middlewares/rocketmq/name-server/rocketmq-analysis-nameserver-start/>RocketMQ源码解析-NameServer启动</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqname-serverrocketmq-analysis-broker-manage href=/middlewares/rocketmq/name-server/rocketmq-analysis-broker-manage/>RocketMQ源码解析-NameServer对Broker的管理</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/broker/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ Broker</a></li><ul><li class=collapse id=middlewaresrocketmqbroker><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-start href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-start/>RocketMQ源码解析-Broker启动</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-nameserver-interaction href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-nameserver-interaction/>RocketMQ源码解析-Broker与NameServer交互</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-message-store href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-message-store/>RocketMQ源码解析-Broker消息存储设计与实现</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-commitlog href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-commitlog/>RocketMQ源码解析-Broker消息存储CommitLog</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-consumequeue href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-consumequeue/>RocketMQ源码解析-Broker消息存储ConsumeQueue</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-recevie-pull href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-recevie-pull/>RocketMQ源码解析-Broker接收拉取消息</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-failure-recovery href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-failure-recovery/>RocketMQ源码解析-Broker故障恢复</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-configfile href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-configfile/>RocketMQ源码解析-Broker存储配置文件说明</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqbrokerrocketmq-analysis-broker-tag-filter href=/middlewares/rocketmq/broker/rocketmq-analysis-broker-tag-filter/>RocketMQ源码解析-Broker 消息Tag过滤</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/producer/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RockerMQ 生产者</a></li><ul><li class=collapse id=middlewaresrocketmqproducer><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerrocketmq-analysis-topic-create-strategy href=/middlewares/rocketmq/producer/rocketmq-analysis-topic-create-strategy/>RocketMQ源码解析-topic创建机制</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerrocketmq-analysis-producer-msgsend-strategy href=/middlewares/rocketmq/producer/rocketmq-analysis-producer-msgsend-strategy/>RocketMQ源码解析-生产者投递消息策略</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerrocketmq-analysis-producer-messagesend href=/middlewares/rocketmq/producer/rocketmq-analysis-producer-messagesend/>RocketMQ源码解析-producer发送消息的流程</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqproducerproducer href=/middlewares/rocketmq/producer/producer/>Producer</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/consumer/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ 消费者</a></li><ul><li class=collapse id=middlewaresrocketmqconsumer><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer/>RocketMQ源码解析-消费者启动源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-scheduledtask href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-scheduledtask/>RocketMQ源码解析-消费者定时任务解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-messagemodel href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-messagemodel/>RocketMQ源码解析-消费模式消费进度加载源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-concurrently href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-concurrently/>RocketMQ源码解析-并发消费消息源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-strategy href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-strategy/>RocketMQ源码解析-消费者消费策略源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-ack href=/middlewares/rocketmq/consumer/rocketmq-analysis-ack/>RocketMQ源码解析-RocketMQ消息ACK机制及消费进度管理</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-ordermessage-consume href=/middlewares/rocketmq/consumer/rocketmq-analysis-ordermessage-consume/>RocketMQ源码解析-RocketMQ顺序消息的投递与消费</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqconsumerrocketmq-analysis-consumer-repeat-consume href=/middlewares/rocketmq/consumer/rocketmq-analysis-consumer-repeat-consume/>RocketMQ源码解析-消费者重复消费</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq/issue/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ Issue</a></li><ul><li class=collapse id=middlewaresrocketmqissue><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqissuebroker-busy-issue href=/middlewares/rocketmq/issue/broker-busy-issue/>broker busy问题</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmqrocketmq-docker href=/middlewares/rocketmq/rocketmq-docker/>RocketMQ Docker部署</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq5/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Apache RocketMQ5</a></li><ul><li class="collapse show" id=middlewaresrocketmq5><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq5/quick-start/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ5.0 Quick start</a></li><ul><li class=collapse id=middlewaresrocketmq5quick-start><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5quick-startdledger-controller href=/middlewares/rocketmq5/quick-start/dledger-controller/>RocketMQ5.0 Controller DLedger模式</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/rocketmq5/store/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RocketMQ5 Store</a></li><ul><li class=collapse id=middlewaresrocketmq5store><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5storecommitlog href=/middlewares/rocketmq5/store/commitlog/>RocketMQ55.0-CommitLog设计与源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5storeautoswitchhaclient-source-code-analysis href=/middlewares/rocketmq5/store/autoswitchhaclient-source-code-analysis/>RocketMQ5.0源码分析-AutoSwitchHAClient</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresrocketmq5storecommitlog-important-attribute href=/middlewares/rocketmq5/store/commitlog-important-attribute/>RocketMQ5.0源码解析-CommitLog设计与几个重要的属性关系图文解析</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page active" id=m-middlewaresrocketmq5habroker-elect-master href=/middlewares/rocketmq5/ha/broker-elect-master/>RocketMQ5.0主备自动切换模式Broker选主详解</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/netty/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Netty</a></li><ul><li class=collapse id=middlewaresnetty><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-annotation-sharable href=/middlewares/netty/netty-annotation-sharable/>Netty @Sharable到底是干什么用的</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/netty/netty-source-code-analysis/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Netty源码解析</a></li><ul><li class=collapse id=middlewaresnettynetty-source-code-analysis><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-analysis-sizeclasses href=/middlewares/netty/netty-source-code-analysis/netty-source-analysis-sizeclasses/>Netty源码解析-sizeClasses</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-analysis-pooled-manage href=/middlewares/netty/netty-source-code-analysis/netty-source-analysis-pooled-manage/>Netty源码解析-池化内存管理解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-fastthreadlocal href=/middlewares/netty/netty-source-code-analysis/netty-fastthreadlocal/>Netty FastThreadLocal相比Java ThreadLocal到底快在哪里?</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-eventloopgroup-howto-work href=/middlewares/netty/netty-source-code-analysis/netty-eventloopgroup-howto-work/>Netty源码分析-EventLoopGroup如何工作</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-eventloop-base href=/middlewares/netty/netty-source-code-analysis/netty-eventloop-base/>Netty组件-EventLoop</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-components-channelhandler href=/middlewares/netty/netty-source-code-analysis/netty-components-channelhandler/>Netty组件-ChannelHandler</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-channelhandler-order href=/middlewares/netty/netty-source-code-analysis/netty-source-channelhandler-order/>Netty源码分析-ChannelHandler方法执行顺序和如何工作</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-decoder href=/middlewares/netty/netty-source-code-analysis/netty-source-decoder/>Netty源码解析-解码器(Decoder)是如何工作</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-cumulator href=/middlewares/netty/netty-source-code-analysis/netty-source-cumulator/>Netty源码解析-累加器(Cumulator)处理粘包半包问题</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-components-channelpipeline-channelcontext href=/middlewares/netty/netty-source-code-analysis/netty-components-channelpipeline-channelcontext/>Netty组件-ChannelHandlerContext和ChannelPipeline</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-channelread-object href=/middlewares/netty/netty-source-code-analysis/netty-source-channelread-object/>Netty源码解析-ChannelInboundHandler#channelRead参数Object对象到底是什么类型</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-serverbootstrap-flow href=/middlewares/netty/netty-source-code-analysis/netty-source-serverbootstrap-flow/>Netty源码解析-服务端启动流程详解</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-eventloop-startrun href=/middlewares/netty/netty-source-code-analysis/netty-source-eventloop-startrun/>Netty源码解析-EventLoop什么时候启动运行</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-source-code-analysisnetty-source-bossgroup-switch-workgroup href=/middlewares/netty/netty-source-code-analysis/netty-source-bossgroup-switch-workgroup/>Netty源码分析-Channel如何从主线程切换到从线程</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-bytebuf href=/middlewares/netty/netty-bytebuf/>Netty四大组件之ByteBuf</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-channel href=/middlewares/netty/netty-channel/>Netty五大组件之Channel</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/netty/netty-faq/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Netty答疑解惑</a></li><ul><li class=collapse id=middlewaresnettynetty-faq><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-faqnetty-faq-eventloopgroup-executor href=/middlewares/netty/netty-faq/netty-faq-eventloopgroup-executor/>Netty答疑解惑-EventLoopGroup执行器线程数小于nThreads会怎么样?</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-faqnetty-faq-components-relation href=/middlewares/netty/netty-faq/netty-faq-components-relation/>Netty答疑解惑-Netty组件之间的关系</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-eventloop href=/middlewares/netty/netty-eventloop/>Netty-EventLoop</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty href=/middlewares/netty/netty/>Netty</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-channelhandler href=/middlewares/netty/netty-channelhandler/>Netty-ChannelHandler组件</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresnettynetty-optimize href=/middlewares/netty/netty-optimize/>Netty优化</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/redis/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Redis</a></li><ul><li class=collapse id=middlewaresredis><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-data-struct href=/middlewares/redis/redis-data-struct/>Redis底层-数据结构</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-persistence href=/middlewares/redis/redis-persistence/>Redis持久化</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-cluster href=/middlewares/redis/redis-cluster/>Redis集群</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-cluster-strategy href=/middlewares/redis/redis-cluster-strategy/>Redis三种集群策略</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresredisredis-data-elimination-strategy href=/middlewares/redis/redis-data-elimination-strategy/>Redis数据淘汰策略</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/kafka/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Kafka</a></li><ul><li class=collapse id=middlewareskafka><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewareskafkakafka-base href=/middlewares/kafka/kafka-base/>kafka基本知识</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/etcd/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ETCD</a></li><ul><li class=collapse id=middlewaresetcd><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresetcdetcd href=/middlewares/etcd/etcd/>ETCD</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/docker/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Docker</a></li><ul><li class=collapse id=middlewaresdocker><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/middlewares/docker/docker-base/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Docker基础知识</a></li><ul><li class=collapse id=middlewaresdockerdocker-base><a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedocker-install href=/middlewares/docker/docker-base/docker-install/>Centos8 Docker安装</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedocker-command href=/middlewares/docker/docker-base/docker-command/>Docker常见的命令</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedockerfile href=/middlewares/docker/docker-base/dockerfile/>Dockfile</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-middlewaresdockerdocker-basedocker-compose-file href=/middlewares/docker/docker-base/docker-compose-file/>Docker Compose file</a></li></ul></ul></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/mxsm/mxsm-website/edit/main/content/en/middlewares/rocketmq5/ha/broker-elect-master.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/mxsm/mxsm-website/new/main/content/en/middlewares/rocketmq5/ha/broker-elect-master.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/mxsm/mxsm-website/issues/new?title=RocketMQ5.0%e4%b8%bb%e5%a4%87%e8%87%aa%e5%8a%a8%e5%88%87%e6%8d%a2%e6%a8%a1%e5%bc%8fBroker%e9%80%89%e4%b8%bb%e8%af%a6%e8%a7%a3" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/mxsm/mxsm-website/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a>
<a id=print href=/middlewares/rocketmq5/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><ul><li><a href=#1-何时选主broker>1. 何时选主Broker</a></li><li><a href=#2-如何选主broker>2. 如何选主Broker</a><ul><li><a href=#21-broker启动注册触发选主>2.1 Broker启动注册触发选主</a></li><li><a href=#22-broker-master-inactive触发选主>2.2 Broker Master Inactive触发选主</a></li><li><a href=#23-admin命令触发选主>2.3 Admin命令触发选主</a></li></ul></li><li><a href=#3-总结>3. 总结</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/middlewares/>Middleware</a></li><li class=breadcrumb-item><a href=/middlewares/rocketmq5/>Apache RocketMQ5</a></li><li class="breadcrumb-item active" aria-current=page><a href=/middlewares/rocketmq5/ha/broker-elect-master/>RocketMQ5.0主备自动切换模式Broker选主详解</a></li></ol></nav><div class=td-content><h1>RocketMQ5.0主备自动切换模式Broker选主详解</h1><div class="td-byline mb-4"><time datetime=2022-10-19 class=text-muted>2022-10-19</time></div><p>RocketMQ5.0增加了主备自动切换模式，这个模式是基于新开发的模块DLedger Controller(基于Raft组件<a href=https://github.com/openmessaging/dledger>DLedger</a>)。下面结合源码来分析一下RocketMQ主备自动切换模式下的选主的流程。</p><blockquote><p>Tips: RocketMQ源码版本：5.0.0</p></blockquote><h2 id=1-何时选主broker>1. 何时选主Broker</h2><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/Broker%20Elect%20Master.png alt="Broker Elect Master"></p><p>Broker的选主发起主要有三种情况：</p><ul><li><p>通过admin命令人为主动发起重新选主</p><p>命令发起具体参照 <strong><code>electMaster</code></strong> 命令(运维命令由笔者开发完成)，详细使用参照命令的说明</p></li><li><p>RocketMQ集群刚搭建Broker启动注册Broker到DLedger Controller，DLedger Controller还没有选主，然后触发选主操作。</p></li><li><p>RocketMQ Broker Master下线或者因为其他情况不能正常提供服务与DLedger Controller服务不能正常连接或者心跳失效，会触发DLedger Controller选主Broker</p></li></ul><h2 id=2-如何选主broker>2. 如何选主Broker</h2><p>文章上面有提到触发选主的三种情况，下面我们就把这三种情况一一进行分析</p><h3 id=21-broker启动注册触发选主>2.1 Broker启动注册触发选主</h3><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/Broker%20Master%20elect%20process.png alt="Broker Master elect process"></p><p>主备自主切换模式下Broker启动时候到底是Master还是Slave需要通过DLedger Controller服务通过选主的方式来确定。</p><p><strong>Broker启动注册到DLedger Controller</strong></p><p>Broker启动后，将Broker的元数据：</p><ul><li>clusterName</li><li>brokerName</li><li>address</li><li>epoch</li><li>maxOffset</li></ul><p>注册到DLedger Controller,由 <strong><code>BrokerOuterAPI#registerBrokerToController</code></strong> 提供注册的服务：</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019180858462.png alt=image-20221019180858462></p><p><strong>DLedger Controller触发选主</strong></p><p><strong>DLedger Controller</strong> 模块的主要逻辑在ReplicasInfoManager中。当DLedger Controller接收到Broker发送的 <strong><code>CONTROLLER_REGISTER_BROKER</code></strong> 消息后就处理选主，由ReplicasInfoManager#registerBroker处理逻辑：</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019182903186.png alt=image-20221019182903186></p><p><strong>Broker Change Role</strong></p><p>Broker注册后收到DLedger Controller返回的数据，根据返回数据的Master Address和Broker的IP进行对比来判断当前Broker是设置为Master还是Slave。</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019190349777.png alt=image-20221019190349777></p><p>到这里就实现了Broker的选主。</p><h3 id=22-broker-master-inactive触发选主>2.2 Broker Master Inactive触发选主</h3><p>Broker Master下线或者Broker Master和DLedger Controller心跳失效触发选主，DLedger Controller有一个定时任务执行 <code>DefaultBrokerHeartbeatManager#scanNotActiveBroker</code> ：</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019191416688.png alt=image-20221019191416688></p><p>通知最终会触发 <code>ControllerManager#onBrokerInactive</code> 方法：</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019191744705.png alt=image-20221019191744705></p><p><strong><code>ReplicasInfoManager#electMaster</code></strong> 负责选主：</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019195612264.png alt=image-20221019195612264></p><blockquote><p>Tips: 笔者领了一个开发一个Preferred Master 的功能任务，可以优先选择某个 Broker 作为 master。还在代码研究和设计阶段。后续会提交PR</p></blockquote><p><strong>参与选主的Broker是从SyncStateSet选取的。</strong></p><p>然后选举的结果通知Broker, <strong><code>AdminBrokerProcessor#notifyBrokerRoleChanged</code></strong> 处理改变：</p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019200415384.png alt=image-20221019200415384></p><p><img src=https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/broker/ha/image-20221019200445279.png alt=image-20221019200445279></p><h3 id=23-admin命令触发选主>2.3 Admin命令触发选主</h3><p>首先看一下命令的说明：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>usage: mqadmin electMaster -a &lt;arg&gt; -b &lt;arg&gt; -c &lt;arg&gt; <span style=color:#ce5c00;font-weight:700>[</span>-h<span style=color:#ce5c00;font-weight:700>]</span> -n &lt;arg&gt;
 -a,--controllerAddress &lt;arg&gt;   The address of controller
 -b,--brokerAddress &lt;arg&gt;       The address of the broker which requires to become master
 -c,--clusterName &lt;arg&gt;         the clusterName of broker
 -h,--help                      Print <span style=color:#204a87>help</span>
 -n,--brokerName &lt;arg&gt;          The broker name of the replicas that require to be manipulated
</code></pre></div><p>指定一个Broker作为Master。后端DLedger Controller的实现也是通过 <strong><code>ReplicasInfoManager#electMaster</code></strong> 实现。</p><p>对于代码的详细细节大家可以去研究一下RocketMQ5.0的代码细节，以及DLedger相关的代码。</p><h2 id=3-总结>3. 总结</h2><p>Master ID由DLedger Controller设置，Slave的ID也是。选举发起方可能是由Broker发起或者由DLedger Controller发起，也有可能手动通过 **<code>Admin electMaster</code>**命令发起。Broker主备自主切换的主要依赖DLedger Controller。</p><blockquote><p>我是蚂蚁背大象(GitHub:mxsm)，文章对你有帮助点赞关注我，文章有不正确的地方请您斧正留言评论~谢谢!</p></blockquote><br><div class=page-blank><div id=disqus_thread></div><script>(function(){var a=document,b=a.createElement('script');b.src='https://ljbmxsm.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><br><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a class="btn btn-primary disabled"><span class=mr-1>←</span> 上一页</a></li><a class="btn btn-primary disabled">下一页 <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://groups.google.com/u/1/g/ljbmxsm><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=个人掘金主页 aria-label=个人掘金主页><a class=text-white target=_blank rel="noopener noreferrer" href=https://juejin.cn/user/1151943918492855><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/mxsm><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>隐私政策</a></small><p class=mt-2><a href=/about/>Home</a></p></div></div></div></footer><div><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><script>$("p img").wrap(function(){return'<a data-fancybox="gallery" href="'+$(this).attr('src')+'"></a>'})</script></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid@8.8.1/dist/mermaid.min.js integrity=sha384-to2w0I1OqmbJ9J6yTnIX+KYU8grNpZoD1dKPLjgEJvMe5L5+/7qvuNa2sQo8WAWj crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js integrity="sha512-tBzZQxySO5q5lqwLWfu8Q+o4VkTcRGOeQGVQ0ueJga4A1RKuzmAu5HXDOXLEjpbKyV7ow9ympVoa6wZLEzRzDg==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.15.0/flowchart.min.js integrity="sha512-6QsSiIybtf8tuZ6xfjRTr2tdtw3Gp4q5RSCh2b6q9seoKEQmhAG1RrCA8F0kXTwivVxRVbp/YF3zOh8rvEAU7Q==" crossorigin=anonymous></script><script src=/js/main.min.b541b310f01941a0abfd76b652b5fb60dac470573775bb5b31ff08fe3f6cea51.js integrity="sha256-tUGzEPAZQaCr/Xa2UrX7YNrEcFc3dbtbMf8I/j9s6lE=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({appId:'JO2SY3WDAC',apiKey:'324ddb3b679c1308e5aa8bf222e07f8b',indexName:'mxsm',inputSelector:'.td-search-input',debug:!1})</script></body></html>