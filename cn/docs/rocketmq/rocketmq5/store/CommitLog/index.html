<!doctype html>
<html class="docs-version-current" lang="cn" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v0.0.0-4192">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-TKMGCBC",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
<link rel="search" type="application/opensearchdescription+xml" title="mxsm(蚂蚁背大象)" href="/cn/opensearch.xml"><title data-react-helmet="true">RocketMQ5.0-CommitLog设计与源码解析 | mxsm(蚂蚁背大象)</title><meta data-react-helmet="true" property="og:url" content="https://blog.ljbmxsm.com/cn/docs/rocketmq/rocketmq5/store/CommitLog"><meta data-react-helmet="true" name="docsearch:language" content="cn"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="og:image" content="https://ionicframework.com/docs/img/meta/open-graph.png"><meta data-react-helmet="true" name="twitter:image" content="https://ionicframework.com/docs/img/meta/open-graph.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="twitter:domain" content="ionicframework.com"><meta data-react-helmet="true" name="twitter:site" content="@ionicframework"><meta data-react-helmet="true" name="twitter:creator" content="ionicframework"><meta data-react-helmet="true" name="fb:page_id" content="1321836767955949"><meta data-react-helmet="true" name="og:type" content="website"><meta data-react-helmet="true" name="og:site_name" content="Ionic Framework Docs"><meta data-react-helmet="true" property="og:title" content="RocketMQ5.0-CommitLog设计与源码解析 | mxsm(蚂蚁背大象)"><meta data-react-helmet="true" name="description" content="RocketMQ4.x设RocketMQ5.0在CommitLog的设计上面基本上没有太多调整，还是沿用了之前的设计。下面来对CommitLog的设计思想和源码进行分析。"><meta data-react-helmet="true" property="og:description" content="RocketMQ4.x设RocketMQ5.0在CommitLog的设计上面基本上没有太多调整，还是沿用了之前的设计。下面来对CommitLog的设计思想和源码进行分析。"><link data-react-helmet="true" rel="shortcut icon" href="/cn/img/meta/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.ljbmxsm.com/cn/docs/rocketmq/rocketmq5/store/CommitLog"><link data-react-helmet="true" rel="alternate" href="https://blog.ljbmxsm.com/cn/docs/rocketmq/rocketmq5/store/CommitLog" hreflang="cn"><link data-react-helmet="true" rel="alternate" href="https://blog.ljbmxsm.com/docs/rocketmq/rocketmq5/store/CommitLog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.ljbmxsm.com/docs/rocketmq/rocketmq5/store/CommitLog" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://O9QSL985BS-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/cn/assets/css/styles.aeab913d.css">
<link rel="preload" href="/cn/assets/js/runtime~main.02af39bf.js" as="script">
<link rel="preload" href="/cn/assets/js/main.ea9284db.js" as="script">
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKMGCBC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/cn/"><div class="navbar__logo"><img src="/cn/logos/ionic-text-docs-dark.svg" alt="Site Logo" class="themedImage_TMUO themedImage--light_4Vu1" height="28" width="139"><img src="/cn/logos/ionic-text-docs-light.svg" alt="Site Logo" class="themedImage_TMUO themedImage--dark_uzRr" height="28" width="139"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">RocketMQ</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cn/docs/rocketmq/rocketmq5">RocketMQ 5.0</a></li><li><a class="dropdown__link" href="/cn/docs/">RocketMQ 4.X</a></li><li><a href="https://github.com/apache/rocketmq" target="_blank" class="dropdown__link"><span>RocketMQ GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://rocketmq.apache.org/" target="_blank" class="dropdown__link"><span>RocketMQ official website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Spring</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">Spring Framework</a></li><li><a class="dropdown__link" href="/cn/docs/">Spring Boot</a></li><li><a class="dropdown__link" href="/cn/docs/">Spring Cloud</a></li><li><a href="https://spring.io/" target="_blank" class="dropdown__link"><span>Spring official website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Java</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">Java SE</a></li><li><a class="dropdown__link" href="/cn/docs/">Java Web</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Middleware</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">Netty</a></li><li><a class="dropdown__link" href="/cn/docs/">Redis</a></li><li><a class="dropdown__link" href="/cn/docs/">Kafka</a></li><li><a class="dropdown__link" href="/cn/docs/">Etcd</a></li><li><a class="dropdown__link" href="/cn/docs/">Docker</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Database</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">SQL</a></li><li><a class="dropdown__link" href="/cn/docs/">MySQL</a></li><li><a class="dropdown__link" href="/cn/docs/">PostgreSQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Theory</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">SQL</a></li><li><a class="dropdown__link" href="/cn/docs/">MySQL</a></li><li><a class="dropdown__link" href="/cn/docs/">PostgreSQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Others</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">SQL</a></li><li><a class="dropdown__link" href="/cn/docs/">MySQL</a></li><li><a class="dropdown__link" href="/cn/docs/">PostgreSQL</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link navbar__link--community">Github Project</a><ul class="dropdown__menu"><li><a href="https://github.com/mxsm/IM" target="_blank" class="dropdown__link"><span>IM<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/rain" target="_blank" class="dropdown__link"><span>Rain<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/mxsm-website" target="_blank" class="dropdown__link"><span>mxsm-website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/benchmark" target="_blank" class="dropdown__link"><span>benchmark<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/spring-sample" target="_blank" class="dropdown__link"><span>spring-sample<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link navbar__link--support">Support</a><ul class="dropdown__menu"><li><a href="https://github.com/mxsm/" target="_blank" class="dropdown__link"><span>Help Center<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div position="right" class="separator"></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link icon-link language navbar__item"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/cn/docs/rocketmq/rocketmq5/store/CommitLog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="/docs/rocketmq/rocketmq5/store/CommitLog" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="https://ionicframework.com/translate" target="_blank" class="dropdown__link"><span>Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a position="right" class="icon-link navbar__item" href="https://twitter.com/Ionicframework" target="_blank"><img src="/cn/logos/twitter.svg" alt="twitter logo"></a><a position="right" class="icon-link navbar__item" href="https://github.com/mxsm" target="_blank"><img src="/cn/logos/github.svg" alt="github logo"></a><a position="right" class="icon-link navbar__item" href="https://ionic.link/discord" target="_blank"><img src="/cn/logos/discord.svg" alt="discord logo"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_GMj9"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_k0Pq"><a target="_self" href="/cn/"><img src="/cn/logos/ionic-text-docs-dark.svg" alt="Site Logo" class="themedImage_TMUO themedImage--light_4Vu1" height="28" width="139"><img src="/cn/logos/ionic-text-docs-light.svg" alt="Site Logo" class="themedImage_TMUO themedImage--dark_uzRr" height="28" width="139"></a><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">rocektmq</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">rocketmq5</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/_index">Apache RocketMQ5</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">ha</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">quick-start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">store</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/AutoSwitchHAClient-source-code-analysis">RocketMQ5.0源码分析-AutoSwitchHAClient</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/AutoSwitchHAService-source-code-analysis">AutoSwitchHAService-source-code-analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/CommitLog-important-attribute">RocketMQ5.0源码解析-CommitLog设计与几个重要的属性关系图文解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/CommitLog">RocketMQ5.0-CommitLog设计与源码解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/_index">RocketMQ5.0 Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/dledger-controller-truncate">DLedger Controller模式下Broker文件截断</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/rocketmq/rocketmq5/store/master-slave-switch-automatic">图说RocketMQ5.0的Broker的主备自动切换的设计与实现</a></li></ul></li></ul></li></ul></li></ul></nav></div></aside><div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/cn/"><div class="navbar__logo"><img src="/cn/logos/ionic-text-docs-dark.svg" alt="Site Logo" class="themedImage_TMUO themedImage--light_4Vu1" height="28" width="139"><img src="/cn/logos/ionic-text-docs-light.svg" alt="Site Logo" class="themedImage_TMUO themedImage--dark_uzRr" height="28" width="139"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">RocketMQ</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cn/docs/rocketmq/rocketmq5">RocketMQ 5.0</a></li><li><a class="dropdown__link" href="/cn/docs/">RocketMQ 4.X</a></li><li><a href="https://github.com/apache/rocketmq" target="_blank" class="dropdown__link"><span>RocketMQ GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://rocketmq.apache.org/" target="_blank" class="dropdown__link"><span>RocketMQ official website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Spring</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">Spring Framework</a></li><li><a class="dropdown__link" href="/cn/docs/">Spring Boot</a></li><li><a class="dropdown__link" href="/cn/docs/">Spring Cloud</a></li><li><a href="https://spring.io/" target="_blank" class="dropdown__link"><span>Spring official website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Java</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">Java SE</a></li><li><a class="dropdown__link" href="/cn/docs/">Java Web</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Middleware</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">Netty</a></li><li><a class="dropdown__link" href="/cn/docs/">Redis</a></li><li><a class="dropdown__link" href="/cn/docs/">Kafka</a></li><li><a class="dropdown__link" href="/cn/docs/">Etcd</a></li><li><a class="dropdown__link" href="/cn/docs/">Docker</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Database</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">SQL</a></li><li><a class="dropdown__link" href="/cn/docs/">MySQL</a></li><li><a class="dropdown__link" href="/cn/docs/">PostgreSQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Theory</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">SQL</a></li><li><a class="dropdown__link" href="/cn/docs/">MySQL</a></li><li><a class="dropdown__link" href="/cn/docs/">PostgreSQL</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Others</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/">SQL</a></li><li><a class="dropdown__link" href="/cn/docs/">MySQL</a></li><li><a class="dropdown__link" href="/cn/docs/">PostgreSQL</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link navbar__link--community">Github Project</a><ul class="dropdown__menu"><li><a href="https://github.com/mxsm/IM" target="_blank" class="dropdown__link"><span>IM<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/rain" target="_blank" class="dropdown__link"><span>Rain<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/mxsm-website" target="_blank" class="dropdown__link"><span>mxsm-website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/benchmark" target="_blank" class="dropdown__link"><span>benchmark<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/mxsm/spring-sample" target="_blank" class="dropdown__link"><span>spring-sample<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link navbar__link--support">Support</a><ul class="dropdown__menu"><li><a href="https://github.com/mxsm/" target="_blank" class="dropdown__link"><span>Help Center<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div position="right" class="separator"></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link icon-link language navbar__item"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/cn/docs/rocketmq/rocketmq5/store/CommitLog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="/docs/rocketmq/rocketmq5/store/CommitLog" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="https://ionicframework.com/translate" target="_blank" class="dropdown__link"><span>Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a position="right" class="icon-link navbar__item" href="https://twitter.com/Ionicframework" target="_blank"><img src="/cn/logos/twitter.svg" alt="twitter logo"></a><a position="right" class="icon-link navbar__item" href="https://github.com/mxsm" target="_blank"><img src="/cn/logos/github.svg" alt="github logo"></a><a position="right" class="icon-link navbar__item" href="https://ionic.link/discord" target="_blank"><img src="/cn/logos/discord.svg" alt="discord logo"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><main class="docMainContainer_Q970"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_MGa7"><div class="docItemContainer_PQH2"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_psec"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>RocketMQ5.0-CommitLog设计与源码解析</h1></header><p>RocketMQ4.x设RocketMQ5.0在CommitLog的设计上面基本上没有太多调整，还是沿用了之前的设计。下面来对CommitLog的设计思想和源码进行分析。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-commitlog示意图">1. CommitLog示意图<a aria-hidden="true" class="hash-link" href="#1-commitlog示意图" title="Direct link to heading">​</a></h3><p>CommitLog是对RocketMQ的存储的抽象，示意图如下：</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/CommitLog%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="CommitLog示意图"></p><p><strong><code>CommitLog</code></strong> 主要由几部分组成：</p><ul><li><strong>MappedFileQueue：</strong> 主要用来操作相关数据存储文件。将一系列的MappedFile抽象成一个队列。</li><li><strong>FlushManager：</strong> 数据落地磁盘的管理，主要分为两类：实时数据刷盘(FlushRealTimeService),以及异步刷盘(GroupCommitService)</li><li><strong>FlushDiskWatcher：</strong> 刷盘观察者，处理队列中的刷盘请求，对于规定时间内没有刷盘成功的进行处理。</li></ul><blockquote><p>Tips: 多目录存储参照<a href="https://github.com/apache/rocketmq/wiki/RIP-7-Multiple-Directories-Storage-Support" target="_blank" rel="noopener noreferrer">RIP-7</a></p></blockquote><p><strong><code>CommitLog</code></strong> 底层主要是通过FileChannel来实现。其中还有一些RocketMQ的自身优化，例如： TransientStorePool。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-mappedfilequeue">2. MappedFileQueue<a aria-hidden="true" class="hash-link" href="#2-mappedfilequeue" title="Direct link to heading">​</a></h3><p><strong><code>MappedFileQueue</code></strong> 是对数据存储文件的一个抽象，将多个数据文件抽象成为一个文件队列。通过这个文件队列对文件进行操作操作。同时保存一些 <strong><code>CommitLog</code></strong> 的属性。来看一下MappedFileQueue中的几个重要的属性：</p><ul><li><strong>storePath：</strong> 数据文件存储的位置</li><li><strong>mappedFileSize：</strong> 单个数据文件的大小</li><li><strong>mappedFiles：</strong> 数据文件列表</li><li><strong>allocateMappedFileService：</strong> 分配文件服务</li><li><strong><code>flushedWhere</code>： 当前刷盘指针，表示该指针之前所有的数据全部持久化到了硬盘上面</strong></li><li><strong><code>committedWhere</code> ：当前数据提交指针，内存中byteBuffer当前的写指针，该值大于等于flushedWhere</strong></li></ul><blockquote><p>Tips: 同步刷盘的过程中flushedWhere等于committedWhere</p></blockquote><p><strong><code>MappedFileQueue</code></strong> 同时提供了一些操作例如：</p><ul><li>刷新文件(更新flushedWhere) MappedFileQueue#flush</li><li>提交文件(更新committedWhere)MappedFileQueue#commit</li><li>以及一些文件的操作，获取最新文件和第一个文件等等。</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="21-mappedfile">2.1 MappedFile<a aria-hidden="true" class="hash-link" href="#21-mappedfile" title="Direct link to heading">​</a></h4><p><strong><code>MappedFile</code></strong> 是对文件的抽象，包含了对RocketMQ数据文件的整个操作。例如获取文件名称、文件大小、判断文件是否可用、是否已经满了等等的操作。</p><p>单个数据文件默认是 <strong>1G</strong> 。然后按照顺序存储Producer发送的消息。数据格式如下图所示：</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/RocketMQ%20%E6%B6%88%E6%81%AF%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.png" alt="RocketMQ 消息数据格式"></p><p>数据文件就是由上图所示的一条条的数据组成。通过观察你可能会发现存储Topic的长度只占用了一个字节。这个也是在使用RocketMQ需要注意的一点就是：</p><p><strong><code>由于只用了一个字节保存Topic的长度所以Topic的最大长度是127字符,如果使用中文长度会更短。</code></strong> 在RocketMQ5.0的版本中增加 <strong><code>PutMessageHook</code></strong> 会在Put Message之前去Check一些必要的数据和参数。例如Topic的长度就其中之一。具体可以参照 <strong><code>HookUtils</code></strong> 工具类。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3-commitlog消息处理流程">3. CommitLog消息处理流程<a aria-hidden="true" class="hash-link" href="#3-commitlog消息处理流程" title="Direct link to heading">​</a></h3><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/CommitLog%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="CommitLog工作流程"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="31-消息校验">3.1 消息校验<a aria-hidden="true" class="hash-link" href="#31-消息校验" title="Direct link to heading">​</a></h4><p>生产者发送消息到 <strong><code>Broker Master</code></strong> 后，在存入 <strong><code>CommitLog</code></strong> 之前首先会经过一个 <strong><code>PutMessageHook</code></strong> 的处理接口类，这个有不同的实现，主要用于校验一些消息的数据如：Message Topic 大小、Message Body大小、以及MessageStore的一些状态等等。</p><blockquote><p>Tips: 通过实现PutMessageHook可以做到更多校验以及一些其他的事情。</p></blockquote><h4 class="anchor anchorWithStickyNavbar_y2LR" id="32-消息处理">3.2 消息处理<a aria-hidden="true" class="hash-link" href="#32-消息处理" title="Direct link to heading">​</a></h4><p><strong><code>CommitLog#asyncPutMessage</code></strong> 在CommitLog有两个分别用来处理单个消息和批量消息。下面以单个消息处理为例</p><ul><li><p><strong>消息的一些属性设置</strong></p><p>消息体的CRC、设置消息生产者的IP地址是否为IPV6、设置存储Broker IP地址是否为IPV6</p></li><li><p><strong>HA处理设置</strong></p><p>根据服务的设置判断是否需要处理HA. RocketMQ5.0 HA有两种模式：</p><ul><li><strong>Controller Model模式：</strong> DLedger模式的进阶版本，对原有的DLedger模式进行优化</li><li><strong>SlaveActingMaster模式</strong></li></ul><p>这两个模式主要目的是根据返回ACK的Slave数量来判断消息是否同步到Slave成功</p></li><li><p><strong>Append Message 到 MappedByteBuffer</strong></p></li><li><p><strong>处理Append的Result</strong></p></li><li><p><strong>根据Broker的配置进行刷盘</strong></p><p>刷盘是根据在启动Broker的时候配置的刷盘模式进行不同的刷盘策略。</p><ul><li><strong>SYNC_FLUSH：</strong> GroupCommitService线程进行实时刷盘</li><li><strong>ASYNC_FLUSH：</strong> FlushRealTimeService线程进行异步刷盘</li></ul></li><li><p><strong>处理HA</strong></p><p>HA的处理不是必须的，这个看RocketMQ是否配置了HA模式。只有配置了才需要进行处理。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4-刷盘解析">4. 刷盘解析<a aria-hidden="true" class="hash-link" href="#4-刷盘解析" title="Direct link to heading">​</a></h3><p>刷盘主要有两种模式：同步刷盘和异步刷盘。刷盘主要由 <strong><code>FlushManager</code></strong> 进行管理。刷盘接口关系：</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/%E5%88%B7%E7%9B%98%E6%8E%A5%E5%8F%A3%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="刷盘接口关系图"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="41-同步刷盘解析">4.1 同步刷盘解析<a aria-hidden="true" class="hash-link" href="#41-同步刷盘解析" title="Direct link to heading">​</a></h4><p>同步刷盘是由 <strong><code>GroupCommitService</code></strong> 来处理，同步刷盘的详细流程如下：</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/%E5%90%8C%E6%AD%A5%E5%88%B7%E7%9B%98%E7%9A%84%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B.png" alt="同步刷盘的详细流程"></p><p>在刷盘过程中使用到的两个类：<strong><code>GroupCommitService</code></strong> 和 <strong><code>FlushDiskWatcher</code></strong> 从本质上看都是一个Thread。</p><p>GroupCommitService处理主要分为三步：</p><ol><li><p>往链表中写入GroupCommitRequest请求</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/image-20220912140817889.png" alt="image-20220912140817889"></p></li><li><p>GroupCommitService执行doCommit方法</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/image-20220912140929356.png" alt="image-20220912140929356"></p></li><li><p>执行刷盘操作，将结果写入GroupCommitRequest</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/image-20220912141357835.png" alt="image-20220912141357835"></p></li></ol><p>到这里就已经基本上完成整个同步的刷盘步骤。细心的可能会发现还有一个 <strong><code>FlushDiskWatcher</code></strong> 这个类。它的功能主要是：处理在规定时间内还没有刷盘成功的请求。</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="42-异步刷盘解析">4.2 异步刷盘解析<a aria-hidden="true" class="hash-link" href="#42-异步刷盘解析" title="Direct link to heading">​</a></h4><p>异步刷盘的服务是<strong><code>FlushRealTimeService</code></strong> ，不过当内存缓存池 <strong><code>TransientStorePool</code></strong> 可用时，消息会先提交到TransientStorePool中的WriteBuffer内部，再提交到MappedFile的FileChannel中，此时异步刷盘服务就是CommitRealTimeService。下面看一下 <strong>FlushRealTimeService</strong> ：</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/image-20220912145045587.png" alt="image-20220912145045587"></p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/image-20220912145109156.png" alt="image-20220912145109156"></p><p>而在启用了暂存池的情况下使用的是 <strong><code>CommitRealTimeService</code></strong> 进行刷盘：</p><p><img src="https://raw.githubusercontent.com/mxsm/picture/main/rocketmq5/store/commitlog/image-20220912151020859.png" alt="image-20220912151020859"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="5-总结">5. 总结<a aria-hidden="true" class="hash-link" href="#5-总结" title="Direct link to heading">​</a></h3><ul><li>CommitLog在RocketMQ中充当一个存储的抽象，所有的存储操作都是通过CommitLog对外暴露。底层包含了很多其他组件来支持</li><li>刷盘的模式可以通过配置文件的 <strong>flushDiskType</strong> 字段来配置，SYNC_FLUSH表示同步刷盘、ASYNC_FLUSH表示异步刷盘</li><li>刷盘的服务主要是由三个服务：FlushRealTimeService、GroupCommitService、CommitRealTimeService来实现刷盘，以及FlushDiskWatcher来处理一些特殊的刷盘情况。这些服务本质上都是线程。</li></ul><blockquote><p>我是蚂蚁背大象，文章对你有帮助点赞关注我，文章有不正确的地方请您斧正留言评论~谢谢</p></blockquote><p>参考资料：</p><ul><li><a href="https://github.com/apache/rocketmq/wiki/RIP-7-Multiple-Directories-Storage-Support" target="_blank" rel="noopener noreferrer">https://github.com/apache/rocketmq/wiki/RIP-7-Multiple-Directories-Storage-Support</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mxsm/mxsm-website/edit/develop/docs/rocketmq/rocketmq5/store/CommitLog.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-edit iconEdit_PItR"><path d="M7 0C3.13438 0 0 3.21563 0 7.17813C0 10.35 2.00625 13.0375 4.7875 13.9875C4.83125 13.9969 4.86875 14 4.90625 14C5.16563 14 5.26562 13.8094 5.26562 13.6438C5.26562 13.4719 5.25938 13.0219 5.25625 12.4219C4.99375 12.4812 4.75938 12.5063 4.55 12.5063C3.20313 12.5063 2.89687 11.4594 2.89687 11.4594C2.57812 10.6313 2.11875 10.4094 2.11875 10.4094C1.50938 9.98125 2.11562 9.96875 2.1625 9.96875H2.16563C2.86875 10.0312 3.2375 10.7125 3.2375 10.7125C3.5875 11.325 4.05625 11.4969 4.475 11.4969C4.80312 11.4969 5.1 11.3906 5.275 11.3094C5.3375 10.8469 5.51875 10.5312 5.71875 10.35C4.16563 10.1688 2.53125 9.55313 2.53125 6.80312C2.53125 6.01875 2.80312 5.37813 3.25 4.87813C3.17812 4.69688 2.9375 3.96563 3.31875 2.97813C3.31875 2.97813 3.36875 2.9625 3.475 2.9625C3.72812 2.9625 4.3 3.05937 5.24375 3.71562C5.80312 3.55625 6.4 3.47812 6.99687 3.475C7.59062 3.47812 8.19063 3.55625 8.75 3.71562C9.69375 3.05937 10.2656 2.9625 10.5188 2.9625C10.625 2.9625 10.675 2.97813 10.675 2.97813C11.0563 3.96563 10.8156 4.69688 10.7437 4.87813C11.1906 5.38125 11.4625 6.02187 11.4625 6.80312C11.4625 9.55937 9.825 10.1656 8.26562 10.3438C8.51562 10.5656 8.74063 11.0031 8.74063 11.6719C8.74063 12.6313 8.73125 13.4062 8.73125 13.6406C8.73125 13.8094 8.82812 14 9.0875 14C9.125 14 9.16875 13.9969 9.2125 13.9875C11.9969 13.0375 14 10.3469 14 7.17813C14 3.21563 10.8656 0 7 0Z" fill="currentColor"></path></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cn/docs/rocketmq/rocketmq5/store/CommitLog-important-attribute"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->RocketMQ5.0源码解析-CommitLog设计与几个重要的属性关系图文解析</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cn/docs/rocketmq/rocketmq5/store/_index"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RocketMQ5.0 Store<!-- --> »</div></a></div></nav></div><div class="spacer"></div></div><div class="end"><div class="toc-wrapper"><h2>Contents</h2><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-commitlog示意图" class="table-of-contents__link toc-highlight">1. CommitLog示意图</a></li><li><a href="#2-mappedfilequeue" class="table-of-contents__link toc-highlight">2. MappedFileQueue</a></li><li><a href="#3-commitlog消息处理流程" class="table-of-contents__link toc-highlight">3. CommitLog消息处理流程</a></li><li><a href="#4-刷盘解析" class="table-of-contents__link toc-highlight">4. 刷盘解析</a></li><li><a href="#5-总结" class="table-of-contents__link toc-highlight">5. 总结</a></li></ul></div><a href="https://github.com/mxsm/mxsm-website/edit/develop/docs/rocketmq/rocketmq5/store/CommitLog.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-edit iconEdit_PItR"><path d="M7 0C3.13438 0 0 3.21563 0 7.17813C0 10.35 2.00625 13.0375 4.7875 13.9875C4.83125 13.9969 4.86875 14 4.90625 14C5.16563 14 5.26562 13.8094 5.26562 13.6438C5.26562 13.4719 5.25938 13.0219 5.25625 12.4219C4.99375 12.4812 4.75938 12.5063 4.55 12.5063C3.20313 12.5063 2.89687 11.4594 2.89687 11.4594C2.57812 10.6313 2.11875 10.4094 2.11875 10.4094C1.50938 9.98125 2.11562 9.96875 2.1625 9.96875H2.16563C2.86875 10.0312 3.2375 10.7125 3.2375 10.7125C3.5875 11.325 4.05625 11.4969 4.475 11.4969C4.80312 11.4969 5.1 11.3906 5.275 11.3094C5.3375 10.8469 5.51875 10.5312 5.71875 10.35C4.16563 10.1688 2.53125 9.55313 2.53125 6.80312C2.53125 6.01875 2.80312 5.37813 3.25 4.87813C3.17812 4.69688 2.9375 3.96563 3.31875 2.97813C3.31875 2.97813 3.36875 2.9625 3.475 2.9625C3.72812 2.9625 4.3 3.05937 5.24375 3.71562C5.80312 3.55625 6.4 3.47812 6.99687 3.475C7.59062 3.47812 8.19063 3.55625 8.75 3.71562C9.69375 3.05937 10.2656 2.9625 10.5188 2.9625C10.625 2.9625 10.675 2.97813 10.675 2.97813C11.0563 3.96563 10.8156 4.69688 10.7437 4.87813C11.1906 5.38125 11.4625 6.02187 11.4625 6.80312C11.4625 9.55937 9.825 10.1656 8.26562 10.3438C8.51562 10.5656 8.74063 11.0031 8.74063 11.6719C8.74063 12.6313 8.73125 13.4062 8.73125 13.6406C8.73125 13.8094 8.82812 14 9.0875 14C9.125 14 9.16875 13.9969 9.2125 13.9875C11.9969 13.0375 14 10.3469 14 7.17813C14 3.21563 10.8656 0 7 0Z" fill="currentColor"></path></svg>Edit this page</a></div></div></div></div></main></div></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">版权所有 © 2022 mxsm(蚂蚁背大象). 使用 Docusaurus 构建.</div></div></div></footer></div>
<script src="/cn/assets/js/runtime~main.02af39bf.js"></script>
<script src="/cn/assets/js/main.ea9284db.js"></script>
</body>
</html>